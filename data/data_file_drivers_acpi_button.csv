commit ID,author name,committer name,message,URL,commit date
C_kwDOACN7MtoAKDdmY2Y4MmU3MzQ4NzY2ODQwZTVlMjU5NDg4NjYyNzUxYzZkYjIyYTc,Muhammad Qasim Abdul Majeed,Rafael J. Wysocki,"ACPI: button: Use strscpy() instead of strcpy()

Replace strcpy() with strscpy() in the ACPI button driver.

strcpy() has been deprecated because it is generally unsafe, so help to
eliminate it from the kernel source.

Link: https://github.com/KSPP/linux/issues/88
Signed-off-by: Muhammad Qasim Abdul Majeed <qasim.majeed20@gmail.com>
Link: https://patch.msgid.link/20240901191826.421488-1-qasim.majeed20@gmail.com
[ rjw: Subject and changelog edits ]
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/7fcf82e7348766840e5e259488662751c6db22a7,2024-09-01
C_kwDOACN7MtoAKDE2ZjcwZmVhYWJlOWZkZTBhZjcwM2YyOTkxZDQ0YTc1ODlmMGI2ZTM,Ken Xue,Rafael J. Wysocki,"ACPI: button: trigger wakeup key events

Andorid can wakeup from various wakeup sources, but only several wakeup
sources can wake up screen with right events(POWER, WAKEUP) from input
device.

Regarding pressing acpi power button, it can resume system and
ACPI_BITMASK_WAKE_STATUS and ACPI_BITMASK_POWER_BUTTON_STATUS are set in
pm1a_sts, but kernel does not report any key event to user space during
resuming by default.

So, send wakeup key event to user space during resume from power button.

Signed-off-by: Ken Xue <Ken.Xue@amd.com>
Reviewed-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
[ rjw: Subject edits ]
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/16f70feaabe9fde0af703f2991d44a7589f0b6e3,2023-12-25
C_kwDOACN7MtoAKGU0ZTYyZDVmZDhlY2IwZWE0MTc0YWZkYTY1NDQzMjkyN2QyNDhhOGE,Rafael J. Wysocki,Rafael J. Wysocki,"ACPI: button: Use different notify handlers for lid and buttons

Since the lid handling in acpi_button_notify() is special, introduce
acpi_lid_notify() specifically for handling lid notifications.

Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/e4e62d5fd8ecb0ea4174afda654432927d248a8a,2023-06-04
C_kwDOACN7MtoAKDBkNTExNTdkZmFhYzA1ZWE2NjYxNmQ4YTI1MGRjZTA0YmVmNDlhNGY,Rafael J. Wysocki,Rafael J. Wysocki,"ACPI: button: Eliminate the driver notify callback

Rework the ACPI button driver to install notify handlers or fixed
event handlers for the devices it binds to by itself, reduce the
indentation level in its notify handler routine and drop its
notify callback.

This will allow acpi_device_install_notify_handler() and
acpi_device_remove_notify_handler() to be simplified going forward
and it will allow the driver to use different notify handlers for the
lid and for the power and sleep buttons.

Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
Reviewed-by: Michal Wilczynski <michal.wilczynski@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/0d51157dfaac05ea66616d8a250dce04bef49a4f,2023-06-04
C_kwDOACN7MtoAKDRmZDU1NTY2MDhiZmE5YzJiZjI3NmZjMTE1ZWYwNDI4ODMzMWFkZWQ,Hans de Goede,Rafael J. Wysocki,"ACPI: button: Add lid disable DMI quirk for Nextbook Ares 8A

The LID0 device on the Nextbook Ares 8A tablet always reports lid
closed causing userspace to suspend the device as soon as booting
is complete.

Add a DMI quirk to disable the broken lid functionality.

Signed-off-by: Hans de Goede <hdegoede@redhat.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/4fd5556608bfa9c2bf276fc115ef04288331aded,2023-04-29
C_kwDOACN7MtoAKDZjMGViNWJhMzUwMGY2ZGEzNjczNTFmZjNjNDQ1MmMwMjljYjcyZmE,Dawei Li,Rafael J. Wysocki,"ACPI: make remove callback of ACPI driver void

For bus-based driver, device removal is implemented as:
1 device_remove()->
2   bus->remove()->
3     driver->remove()

Driver core needs no inform from callee(bus driver) about the
result of remove callback. In that case, commit fc7a6209d571
(""bus: Make remove callback return void"") forces bus_type::remove
be void-returned.

Now we have the situation that both 1 & 2 of calling chain are
void-returned, so it does not make much sense for 3(driver->remove)
to return non-void to its caller.

So the basic idea behind this change is making remove() callback of
any bus-based driver to be void-returned.

This change, for itself, is for device drivers based on acpi-bus.

Acked-by: Uwe Kleine-KÃ¶nig <u.kleine-koenig@pengutronix.de>
Acked-by: Lee Jones <lee@kernel.org>
Acked-by: Dmitry Torokhov <dmitry.torokhov@gmail.com>
Reviewed-by: Hans de Goede <hdegoede@redhat.com>
Signed-off-by: Dawei Li <set_pte_at@outlook.com>
Reviewed-by: Maximilian Luz <luzmaximilian@gmail.com>  # for drivers/platform/surface/*
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/6c0eb5ba3500f6da367351ff3c4452c029cb72fa,2022-11-13
MDY6Q29tbWl0MjMyNTI5ODoxYTIwZDQwOWM4NzQyNTUwODZlMmY0MmE3Mjk4MjZkNDkwMjk0Yzkx,Ulrich Huber,Rafael J. Wysocki,"ACPI: button: Add DMI quirk for Lenovo Yoga 9 (14INTL5)

The Lenovo Yoga 9 (14INTL5)'s ACPI _LID is bugged:

After hibernation the lid is initially reported as closed.
Once closing and then reopening the lid reports the lid as
open again. This leads to the conclusion that the initial
notification of the lid is missing but subsequent
notifications are correct.

In order fo the Linux LID code to handle this device properly
the lid_init_state must be set to ACPI_BUTTON_LID_INIT_OPEN.

Signed-off-by: Ulrich Huber <ulrich@huberulrich.de>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/1a20d409c874255086e2f42a729826d490294c91,2021-08-24
MDY6Q29tbWl0MjMyNTI5ODplZmZiZTY0MDRlNmMxY2NjYWEzNTFhNTBmMWQ0MzFmODNiMzRkOWE1,Xiaofei Tan,Rafael J. Wysocki,"ACPI: button: fix some coding style issues

Fix some coding style issues reported by checkpatch.pl, including the
following types:

WARNING: Block comments use * on subsequent lines
WARNING: Block comments use a trailing */ on a separate line
ERROR: code indent should use tabs where possible

Signed-off-by: Xiaofei Tan <tanxiaofei@huawei.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/effbe6404e6c1cccaa351a50f1d431f83b34d9a5,2021-03-27
MDY6Q29tbWl0MjMyNTI5ODo0MTFlMzIxNmQ0ZWU3ZTNjMjVjMzY1YjBkMDllMThmNzc5OGQ3MDVh,Rafael J. Wysocki,Rafael J. Wysocki,"ACPI: button: Clean up printing messages

Replace the ACPI_DEBUG_PRINT() instance in button.c with an
acpi_handle_debug() call, drop the _COMPONENT and ACPI_MODULE_NAME()
definitions that are not used any more, drop the no longer needed
ACPI_BUTTON_COMPONENT definition from the headers and update the
documentation accordingly.

While at it, replace the direct printk() invocations with pr_info()
(that changes the excessive log level for some of them too) and drop
the unneeded PREFIX sybmbol definition from battery.c.

Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
Reviewed-by: Hanjun Guo <guohanjun@huawei.com>
Reviewed-by: Hans de Goede <hdegoede@redhat.com>",https://api.github.com/repos/torvalds/linux/git/commits/411e3216d4ee7e3c25c365b0d09e18f7798d705a,2021-02-03
MDY6Q29tbWl0MjMyNTI5ODo3ZGFhYTA2MzU3YmY3ZjE4NzRiNjJiYjFlYTlkNjZhNTFkNGU1Njdl,Hans de Goede,Rafael J. Wysocki,"ACPI: button: Add DMI quirk for Medion Akoya E2228T

The Medion Akoya E2228T's ACPI _LID implementation is quite broken,
it has the same issues as the one from the Medion Akoya E2215T:

1. For notifications it uses an ActiveLow Edge GpioInt, rather then
   an ActiveBoth one, meaning that the device is only notified when the
   lid is closed, not when it is opened.

2. Matching with this its _LID method simply always returns 0 (closed)

In order for the Linux LID code to work properly with this implementation,
the lid_init_state selection needs to be set to ACPI_BUTTON_LID_INIT_OPEN,
add a DMI quirk for this.

While working on this I also found out that the MD60### part of the model
number differs per country/batch while all of the E2215T and E2228T models
have this issue, so also remove the "" MD60198"" part from the E2215T quirk.

Signed-off-by: Hans de Goede <hdegoede@redhat.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/7daaa06357bf7f1874b62bb1ea9d66a51d4e567e,2020-11-07
MDY6Q29tbWl0MjMyNTI5ODoxMzZhNGRmZTg3Y2QzNGRiMjE1MzMzMGFhODRkYmJjMjEwZWIzNmI2,Hans de Goede,Rafael J. Wysocki,"ACPI: button: Drop no longer necessary Acer SW5-012 lid_init_state quirk

Commit 78a5b53e9fb4 (""Input: soc_button_array - work around DSDTs which
modify the irqflags"") adds a workaround for DSDTs with a _LID method
which play tricks with the irqflags, assuming that the OS is using
an irq-type of IRQ_TYPE_LEVEL_LOW.

Now that this workaround is in place, we no longer need to disable the
lid functionality on the Acer SW5-012.

Fixes: 78a5b53e9fb4 (""Input: soc_button_array - work around DSDTs which modify the irqflags"")
Signed-off-by: Hans de Goede <hdegoede@redhat.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/136a4dfe87cd34db2153330aa84dbbc210eb36b6,2020-10-26
MDY6Q29tbWl0MjMyNTI5ODoyMTk4OGE4ZTUxNDc5Y2VmZmU3YjA1NjhiMTcwZWZmYWJiNzA4ZGZl,dmitry.torokhov@gmail.com,Rafael J. Wysocki,"ACPI: button: fix handling lid state changes when input device closed

The original intent of 84d3f6b76447 was to delay evaluating lid state until
all drivers have been loaded, with input device being opened from userspace
serving as a signal for this condition. Let's ensure that state updates
happen even if userspace closed (or in the future inhibited) input device.

Note that if we go through suspend/resume cycle we assume the system has
been fully initialized even if LID input device has not been opened yet.

This has a side-effect of fixing access to input->users outside of
input->mutex protections by the way of eliminating said accesses and using
driver private flag.

Fixes: 84d3f6b76447 (""ACPI / button: Delay acpi_lid_initialize_state() until first user space open"")
Signed-off-by: Dmitry Torokhov <dmitry.torokhov@gmail.com>
Reviewed-by: Hans de Goede <hdegoede@redhat.com>
Cc: 4.15+ <stable@vger.kernel.org> # 4.15+
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/21988a8e51479ceffe7b0568b170effabb708dfe,2020-10-05
MDY6Q29tbWl0MjMyNTI5ODo1N2QyZGQ0YmQxOGIxMzc4YjNiYzBiNmIyYjhiODU4ZGViNmMyZmE3,Gustavo A. R. Silva,Rafael J. Wysocki,"ACPI: Use fallthrough pseudo-keyword

Replace the existing /* fall through */ comments and its variants with
the new pseudo-keyword macro fallthrough[1]. Also, remove unnecessary
fall-through markings when it is the case.

Link: https://www.kernel.org/doc/html/latest/process/deprecated.html?highlight=fallthrough#implicit-switch-case-fall-through # [1]
Signed-off-by: Gustavo A. R. Silva <gustavoars@kernel.org>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/57d2dd4bd18b1378b3bc0b6b2b8b858deb6c2fa7,2020-07-07
MDY6Q29tbWl0MjMyNTI5ODphMTA2NjBmNzc4OGJjYjEyMjk1MzRjZDFhYTU3YThmNGIzNmNmZTc0,Pascal Terjan,Rafael J. Wysocki,"ACPI: Delete unused proc filename macros

Those were used to create files in /proc/acpi long ago
and were missed when that code was deleted.

Signed-off-by: Pascal Terjan <pterjan@google.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/a10660f7788bcb1229534cd1aa57a8f4b36cfe74,2020-05-10
MDY6Q29tbWl0MjMyNTI5ODoyYjYwMjJhMzJlMWM2ZTc0MGE1OTI5OTUxZDlkOGNiZWQzYjE2MmIx,Hans de Goede,Rafael J. Wysocki,"ACPI: button: Drop no longer necessary Asus T200TA lid_init_state quirk

Commit 17e5888e4e18 (""x86: Select HARDIRQS_SW_RESEND on x86"") fixes
the edge-triggered embedded-controller (WC) IRQ not being replayed after
resume when woken by opening the lid, which gets signaled by the EC.

This means that the lid_init_state=ACPI_BUTTON_LID_INIT_OPEN quirk for
the Asus T200TA is no longer necessary, the lid now works properly
without it, so drop the quirk.

Fixes: 17e5888e4e18 (""x86: Select HARDIRQS_SW_RESEND on x86"")
Signed-off-by: Hans de Goede <hdegoede@redhat.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/2b6022a32e1c6e740a5929951d9d8cbed3b162b1,2020-04-19
MDY6Q29tbWl0MjMyNTI5ODphYzFjYzZiNDg1NmZmYTdlY2I4MThiM2NlYjgyYmZjNDM1OTdkNjEz,Josh Triplett,Rafael J. Wysocki,"ACPI: button: move HIDs to acpi/button.h

This makes it possible to use ACPI_BUTTON_HID_POWER in another driver.

Signed-off-by: Josh Triplett <josh@joshtriplett.org>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/ac1cc6b4856ffa7ecb818b3ceb82bfc43597d613,2020-02-11
MDY6Q29tbWl0MjMyNTI5ODowNTI4OTA0OTI2YWFiMTliZmZiMjA2ODg3OWFhNDRkYjE2NmM2ZDVm,Jason Ekstrand,Rafael J. Wysocki,"ACPI: button: Add DMI quirk for Razer Blade Stealth 13 late 2019 lid switch

Running evemu-record on the lid switch event shows that the lid reports
the first ""close"" but then never reports an ""open"".  This causes systemd
to continuously re-suspend the laptop every 30s.  Resetting the _LID to
""open"" fixes the issue.

Signed-off-by: Jason Ekstrand <jason@jlekstrand.net>
Reviewed-by: Hans de Goede <hdegoede@redhat.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/0528904926aab19bffb2068879aa44db166c6d5f,2020-01-02
MDY6Q29tbWl0MjMyNTI5ODo5MGVkOWM2MzljMWI1MzU1NmY4N2IxYzUwMzFjN2U0YzU3Mjg1YTky,Hans de Goede,Rafael J. Wysocki,"ACPI: button: Add DMI quirk for Acer Switch 10 SW5-032 lid-switch

The Acer Switch 10 SW5-032 _LID method is quite broken, it looks like this:

            Method (_LID, 0, NotSerialized)  // _LID: Lid Status
            {
                If ((STAS & One))
                {
                    Local0 = One
                    PBCG |= 0x05000000
                    HMCG |= 0x05000000
                }
                Else
                {
                    Local0 = Zero
                    PBCG &= 0xF0FFFFFF
                    HMCG &= 0xF0FFFFFF
                }

                ^^PCI0.GFX0.CLID = Local0
                Return (Local0)
            }

The problem here is the accesses to the PBCG and HMCG, these are the
pinconf0 registers for the power, resp. the home button GPIO,
e.g. PBCG is declared as:

            OperationRegion (PWBT, SystemMemory, 0xFED0E080, 0x10)
            Field (PWBT, DWordAcc, NoLock, Preserve)
            {
                PBCG,   32,
                PBV1,   32,
                PBSA,   32,
                PBV2,   32
            }

Where 0xFED0E000 is the base address of the GPO2 device and 0x80 is
the offset for the pin used for the powerbutton.

The problem here is this line in _LID:
                    PBCG |= 0x05000000

This changes the trigger flags of the GPIO, changing when it generates
interrupts. Note it does not clear the original flags. Linux uses an
edge triggered interrupt on both positive and negative edges. This |=
adds the BYT_TRIG_LVL flag to this, so now it is turned into a level
interrupt which fires both when low and high, iow it simply always
fires leading to an interrupt storm, the tablet immediately waking up
from suspend again, etc.

There is nothing we can do to fix this, except for a DSDT override,
which the user needs to do manually. The only thing we can do is
never call _LID, which requires disabling the lid-switch functionality
altogether.

This commit adds a quirk for this, as no lid-switch function is better
then the interrupt storm. A user manually applying a DSDT override can
also override the quirk on the kernel cmdline.

Signed-off-by: Hans de Goede <hdegoede@redhat.com>
Reviewed-by: Mika Westerberg <mika.westerberg@linux.intel.com>
Reviewed-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/90ed9c639c1b53556f87b1c5031c7e4c57285a92,2019-11-18
MDY6Q29tbWl0MjMyNTI5ODplMzQ2ZDBjZjJjMGEyZGM5ZTYzZDViOTA4MjRiYmU1YWMwY2M0M2Uy,Hans de Goede,Rafael J. Wysocki,"ACPI: button: Remove unused acpi_lid_notifier_[un]register() functions

There are no users of the acpi_lid_notifier_[un]register functions,
so lets remove them.

Reviewed-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
Signed-off-by: Hans de Goede <hdegoede@redhat.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/e346d0cf2c0a2dc9e63d5b90824bbe5ac0cc43e2,2019-10-26
MDY6Q29tbWl0MjMyNTI5ODowMGUyNTAzNjdjYzZjNGFiODBmZWE2ZWM2MDVkNDY0ZTYyNGJkNTIw,Hans de Goede,Rafael J. Wysocki,"ACPI: button: Add DMI quirk for Asus T200TA

The Asus T200TA lid has some weird behavior where _LID keeps reporting
closed after every second openening of the lid. Causing immediate
re-suspend after opening every other open.

I've looked at the AML code but it involves talking to the EC and we
have no idea what the EC is doing. Setting lid_init_state to
ACPI_BUTTON_LID_INIT_OPEN fixes the unwanted behavior, so this commit
adds a DMI based quirk to use ACPI_BUTTON_LID_INIT_OPEN on the T200TA.

Signed-off-by: Hans de Goede <hdegoede@redhat.com>
Reviewed-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/00e250367cc6c4ab80fea6ec605d464e624bd520,2019-10-26
MDY6Q29tbWl0MjMyNTI5ODo5MzJlMWJhNDg2MTE3ZGUyZmNlYTNkZjI3YWQ4MjE4YWQ2YzExNDcw,Hans de Goede,Rafael J. Wysocki,"ACPI: button: Add DMI quirk for Medion Akoya E2215T

The Medion Akoya E2215T's ACPI _LID implementation is quite broken:

 1. For notifications it uses an ActiveLow Edge GpioInt, rather then
    an ActiveBoth one, meaning that the device is only notified when the
    lid is closed, not when it is opened.

2. Matching with this its _LID method simply always returns 0 (closed)

  In order for the Linux LID code to work properly with this implementation,
  the lid_init_state selection needs to be set to ACPI_BUTTON_LID_INIT_OPEN.

This commit adds a DMI quirk for this.

Reviewed-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
Signed-off-by: Hans de Goede <hdegoede@redhat.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/932e1ba486117de2fcea3df27ad8218ad6c11470,2019-10-26
MDY6Q29tbWl0MjMyNTI5ODpkN2NkMDgyMzFhN2ZhZmIwZDgxNzg2NTE1NTI3NjUxZDMyNDJhN2Y0,Hans de Goede,Rafael J. Wysocki,"ACPI: button: Turn lid_blacklst DMI table into a generic quirk table

Commit 3540c32a9ae4 (""ACPI / button: Add quirks for initial lid state
notification"") added 3 different modes to the LID handling code to deal
with various buggy implementations.

Until now users which need one of the 2 non-default modes to get their
HW to work have to pass a kernel commandline option for this.

E.g. https://bugzilla.kernel.org/show_bug.cgi?id=106151 was closed with a
note that the user has to add ""button.lid_init_state=open"" to the kernel
commandline to get the LID code to not cause undesirable suspends on his
Samsung N210 Plus.

This commit modifies the existing lid_blacklst DMI table so that it can
be used not only to completely disable the LID code on devices where
the ACPI tables are broken beyond repair, but also to select one of the 2
non default LID handling modes on devices where this is necessary.

This will allow us to add quirks to make the LID work OOTB on broken
devices. Getting this working OOTB is esp. important because the typical
breakage is false LID closed reporting, causing undesirable suspends which
basically make the system unusable.

Reviewed-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
Signed-off-by: Hans de Goede <hdegoede@redhat.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/d7cd08231a7fafb0d81786515527651d3242a7f4,2019-10-26
MDY6Q29tbWl0MjMyNTI5ODo1OTM2ODFlMmM3NWY1OWYyM2NmNmY2Y2VmYzRmMDBjYWUyYTQ1MjJi,Hans de Goede,Rafael J. Wysocki,"ACPI: button: Allow disabling LID support with the lid_init_state module option

Add a new ""disabled"" value for the lid_init_state module option, which can
be used to disable LID support on devices where it is completely broken.

Sometimes devices seem to spontaneously suspend and the cause for this is
not clear. The LID switch is known to be one possible cause for this,
this commit allows easily disabling the LID switch for testing if it
is the cause.

For example some devices which do not even have a lid, still have a LID
device in their ACPI tables, pointing to a floating GPIO.

This is not really related to the initial LID state, but re-using the
existing option keeps things simple and it will make it much easier to
add DMI quirks which can either disable the LID completely or set another
non-default lid_init_state value, both of which are necessary on some
devices.

Reviewed-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
Signed-off-by: Hans de Goede <hdegoede@redhat.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/593681e2c75f59f23cf6f6cefc4f00cae2a4522b,2019-10-26
MDY6Q29tbWl0MjMyNTI5ODowNjViZDRkMzViM2ZiNDQ4NGM2MWZjNDBhNTFlZWZmZDVhYmU1MmU4,Hans de Goede,Rafael J. Wysocki,"ACPI: button: Refactor lid_init_state module parsing code

Replace the weird strncmp() calls in param_set_lid_init_state(),
which look to me like they will also accept things like ""opennnn""
to use sysfs_match_string instead.

Also rewrite param_get_lid_init_state() using the new lid_init_state_str
array. Instead of doing a straightforward one line replacement, e.g. :
  return sprintf(buffer, lid_init_state_str[lid_init_state]);
print all possible values, putting [] around the selected value, so
that users can easily find out what the possible values are.

Reviewed-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
Signed-off-by: Hans de Goede <hdegoede@redhat.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/065bd4d35b3fb4484c61fc40a51eeffd5abe52e8,2019-10-26
MDY6Q29tbWl0MjMyNTI5ODpjOTQyZmRkZjg3OTNiMjAxM2JlOGM5MDFiNDdkMGE4ZGMwMmJmOTlm,Thomas Gleixner,Greg Kroah-Hartman,"treewide: Replace GPLv2 boilerplate/reference with SPDX - rule 157

Based on 3 normalized pattern(s):

  this program is free software you can redistribute it and or modify
  it under the terms of the gnu general public license as published by
  the free software foundation either version 2 of the license or at
  your option any later version this program is distributed in the
  hope that it will be useful but without any warranty without even
  the implied warranty of merchantability or fitness for a particular
  purpose see the gnu general public license for more details

  this program is free software you can redistribute it and or modify
  it under the terms of the gnu general public license as published by
  the free software foundation either version 2 of the license or at
  your option any later version [author] [kishon] [vijay] [abraham]
  [i] [kishon]@[ti] [com] this program is distributed in the hope that
  it will be useful but without any warranty without even the implied
  warranty of merchantability or fitness for a particular purpose see
  the gnu general public license for more details

  this program is free software you can redistribute it and or modify
  it under the terms of the gnu general public license as published by
  the free software foundation either version 2 of the license or at
  your option any later version [author] [graeme] [gregory]
  [gg]@[slimlogic] [co] [uk] [author] [kishon] [vijay] [abraham] [i]
  [kishon]@[ti] [com] [based] [on] [twl6030]_[usb] [c] [author] [hema]
  [hk] [hemahk]@[ti] [com] this program is distributed in the hope
  that it will be useful but without any warranty without even the
  implied warranty of merchantability or fitness for a particular
  purpose see the gnu general public license for more details

extracted by the scancode license scanner the SPDX license identifier

  GPL-2.0-or-later

has been chosen to replace the boilerplate/reference in 1105 file(s).

Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
Reviewed-by: Allison Randal <allison@lohutok.net>
Reviewed-by: Richard Fontana <rfontana@redhat.com>
Reviewed-by: Kate Stewart <kstewart@linuxfoundation.org>
Cc: linux-spdx@vger.kernel.org
Link: https://lkml.kernel.org/r/20190527070033.202006027@linutronix.de
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>",https://api.github.com/repos/torvalds/linux/git/commits/c942fddf8793b2013be8c901b47d0a8dc02bf99f,2019-05-27
MDY6Q29tbWl0MjMyNTI5ODoxM2U5NjIxNDBiZTY3MWYzMWEwMTE1NDNmMTE0NzdhZjY3YTZjMzNl,Zhang Rui,Rafael J. Wysocki,"ACPI: button: reinitialize button state upon resume

With commit dfa46c50f65b (""ACPI / button: Fix an issue in
button.lid_init_state=ignore mode""), the lid device is considered to be
not compliant to SW_LID if the Lid state is unchanged when updating it.

This is not wrong, but we overlooked the resume case, where Lid state is
updated unconditionally in the button driver .resume() callback. And this
results in warning message ""ACPI: button: The lid device is not compliant
to  SW_LID."" after resume, if the machine is suspended with Lid opened and
then resumed with Lid opened.

Fix this by flushing the cached lid state before updating the Lid device
in .resume() callback.

Fixes: dfa46c50f65b (""ACPI / button: Fix an issue in button.lid_init_state=ignore mode"")
Reported-and-tested-by: Zhao Lijian <lijian.zhao@intel.com>
Signed-off-by: Zhang Rui <rui.zhang@intel.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/13e962140be671f31a011543f11477af67a6c33e,2019-04-02
MDY6Q29tbWl0MjMyNTI5ODoyYzRjMmE3MWJkNmY3NWMzOTgyYWMwOTQwNzg4OWIxMTA2NzNhYzgz,Randy Dunlap,Rafael J. Wysocki,"ACPI / button: fix defined but not used warning

Fix a build warning in the ACPI button driver when CONFIG_PROC_FS
is not enabled by marking the unused function as __maybe_unused.

../drivers/acpi/button.c:252:12: warning: 'acpi_button_state_seq_show' defined but not used [-Wunused-function]

Signed-off-by: Randy Dunlap <rdunlap@infradead.org>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/2c4c2a71bd6f75c3982ac09407889b110673ac83,2018-07-07
MDY6Q29tbWl0MjMyNTI5ODo3YzA1OGM3Yzc0YjNkYmViN2QxNTdjMjczOTU5Zjg3ZmFmNzEwMzUw,Ravi Chandra Sadineni,Rafael J. Wysocki,"ACPI / button: increment wakeup count only when notified

Because acpi_lid_initialize_state() is called on every system
resume and it triggers acpi_lid_notify_state() which invokes
acpi_pm_wakeup_event() for the lid device, the lid's wakeup count is
incremented even if the lid was not the source of the event that woke up
the system. That behavior confuses user space deamons using
wakeup_count to identify the potential system wakeup source. To avoid
the confusion, only trigger acpi_pm_wakeup_event() in the
acpi_button_notify() path and don't do that in the
acpi_lid_initialize_state() path.

Signed-off-by: Ravi Chandra Sadineni <ravisadineni@chromium.org>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/7c058c7c74b3dbeb7d157c273959f87faf710350,2018-06-27
MDY6Q29tbWl0MjMyNTI5ODozZjM5NDJhY2E2ZGEzNTFhMTI1NDNhYTc3NjQ2Nzc5MWI2M2IzYTc4,Christoph Hellwig,Christoph Hellwig,"proc: introduce proc_create_single{,_data}

Variants of proc_create{,_data} that directly take a seq_file show
callback and drastically reduces the boilerplate code in the callers.

All trivial callers converted over.

Signed-off-by: Christoph Hellwig <hch@lst.de>",https://api.github.com/repos/torvalds/linux/git/commits/3f3942aca6da351a12543aa776467791b63b3a78,2018-05-15
MDY6Q29tbWl0MjMyNTI5ODphYzFlNTViMWZkYjI3YzFiMDdhMGE2ZmU1MTlmMTI5MWZmMWU3ZDQw,Ard Biesheuvel,Rafael J. Wysocki,"ACPI / button: make module loadable when booted in non-ACPI mode

Modules such as nouveau.ko and i915.ko have a link time dependency on
acpi_lid_open(), and due to its use of acpi_bus_register_driver(),
the button.ko module that provides it is only loadable when booted in
ACPI mode. However, the ACPI button driver can be built into the core
kernel as well, in which case the dependency can always be satisfied,
and the dependent modules can be loaded regardless of whether the
system was booted in ACPI mode or not.

So let's fix this asymmetry by making the ACPI button driver loadable
as a module even if not booted in ACPI mode, so it can provide the
acpi_lid_open() symbol in the same way as when built into the kernel.

Signed-off-by: Ard Biesheuvel <ard.biesheuvel@linaro.org>
[ rjw: Minor adjustments of comments, whitespace and names. ]
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/ac1e55b1fdb27c1b07a0a6fe519f1291ff1e7d40,2018-04-23
MDY6Q29tbWl0MjMyNTI5ODo5ZTgxMWUxOWE3YWNhMTZkNDBlMWNlMGM2OGU5YmJmZmVhMWI5ODEw,Hans de Goede,Rafael J. Wysocki,"ACPI: button: Add a LID switch blacklist and add 1 model to it

The GP-electronic T701 tablet does not have a LID switch, but it
does define a LID device in its DSDT. The _LID method points to
the ""\\_SB.GPO2"" pin 0x18 GPIO with a pull setting of ""PullDefault"",
which leaves the pin floating.

This causes the ACPI button driver to cause spurious LID closed events,
causing the device to suspend while the user is using it. There is
nothing the ACPI button driver (or the gpio code) can do to fix this,
so the only solution is to add a DMI based blacklist and ignore the LID
device on these tablets.

Signed-off-by: Hans de Goede <hdegoede@redhat.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/9e811e19a7aca16d40e1ce0c68e9bbffea1b9810,2017-11-22
MDY6Q29tbWl0MjMyNTI5ODphZTM1ZDY1NmQ3OTZmYTIwMzc4NzQ1NWNlNTk4NzRjNjY4MmRjMGNm,Hans de Goede,Rafael J. Wysocki,"ACPI: button: Add a debug message when we're sending a LID event

I've been debugging some spurious suspend issues on various devices,
at least on some devices these spurious suspends are caused by surious
LID closed events being send to userspace.

Running e.g. evemu-record after noticing a spurious suspend is too late
to detect that a LID closed event it the (probable) cause of this.

This commit adds an acpi_handle_debug call to help debugging this.

Signed-off-by: Hans de Goede <hdegoede@redhat.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/ae35d656d796fa203787455ce59874c6682dc0cf,2017-11-22
MDY6Q29tbWl0MjMyNTI5ODo4NGQzZjZiNzY0NDc4OTY5MTljNjNiMjhhZDcxZjcxMjM4Y2VmY2Nl,Hans de Goede,Rafael J. Wysocki,"ACPI / button: Delay acpi_lid_initialize_state() until first user space open

ACPI _LID methods may depend on OpRegions and do not always handle
handlers for those OpRegions not being present properly e.g. :

            Method (_LID, 0, NotSerialized)  // _LID: Lid Status
            {
                If ((^^I2C5.PMI1.AVBL == One) && (^^GPO2.AVBL == One))
                {
                    Return (^^GPO2.LPOL) /* \_SB_.GPO2.LPOL */
                }
            }

Note the missing Return (1) when either of the OpRegions is not available,
this causes (in this case) a report of the lid-switch being closed,
which causes userspace to do an immediate suspend at boot.

This commit delays getting the initial state and thus calling _LID for
the first time until userspace opens the /dev/input/event# node. This
ensures that all drivers will have had a chance to load and registerer
their OpRegions before the first _LID call, fixing this issue.

Signed-off-by: Hans de Goede <hdegoede@redhat.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/84d3f6b76447896919c63b28ad71f71238cefcce,2017-09-11
MDY6Q29tbWl0MjMyNTI5ODplNGRjYTdiN2FhMDhiMjI4OTNjNDU0ODVkMjIyYjU4MDdjMTM3NWFl,Kees Cook,Jessica Yu,"treewide: Fix function prototypes for module_param_call()

Several function prototypes for the set/get functions defined by
module_param_call() have a slightly wrong argument types. This fixes
those in an effort to clean up the calls when running under type-enforced
compiler instrumentation for CFI. This is the result of running the
following semantic patch:

@match_module_param_call_function@
declarer name module_param_call;
identifier _name, _set_func, _get_func;
expression _arg, _mode;
@@

 module_param_call(_name, _set_func, _get_func, _arg, _mode);

@fix_set_prototype
 depends on match_module_param_call_function@
identifier match_module_param_call_function._set_func;
identifier _val, _param;
type _val_type, _param_type;
@@

 int _set_func(
-_val_type _val
+const char * _val
 ,
-_param_type _param
+const struct kernel_param * _param
 ) { ... }

@fix_get_prototype
 depends on match_module_param_call_function@
identifier match_module_param_call_function._get_func;
identifier _val, _param;
type _val_type, _param_type;
@@

 int _get_func(
-_val_type _val
+char * _val
 ,
-_param_type _param
+const struct kernel_param * _param
 ) { ... }

Two additional by-hand changes are included for places where the above
Coccinelle script didn't notice them:

	drivers/platform/x86/thinkpad_acpi.c
	fs/lockd/svc.c

Signed-off-by: Kees Cook <keescook@chromium.org>
Signed-off-by: Jessica Yu <jeyu@kernel.org>",https://api.github.com/repos/torvalds/linux/git/commits/e4dca7b7aa08b22893c45485d222b5807c1375ae,2017-10-18
MDY6Q29tbWl0MjMyNTI5ODpiNmFlYWI0NGVkMzg3ZTUyNjRkMjk2OWJjN2RlZWU5OTNiMjlhNTE1,Vincent Legoll,Rafael J. Wysocki,"ACPI: fix whitespace in pr_fmt() to align log entries

See this dmesg extract before the patch:

[    0.679466] ACPI: Dynamic OEM Table Load:
[    0.679470] ACPI: SSDT 0xFFFF910F6B497E00 00018A (v02 PmRef  ApCst    00003000 INTL 20160422)
[    0.679579] ACPI: Executed 1 blocks of module-level executable AML code
[    0.681477] ACPI : EC: EC started
[    0.681478] ACPI : EC: interrupt blocked
[    0.684798] ACPI: Interpreter enabled
[    0.684835] ACPI: (supports S0 S3 S4 S5)

Signed-off-by: Vincent Legoll <vincent.legoll@gmail.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/b6aeab44ed387e5264d2969bc7deee993b29a515,2017-05-20
MDY6Q29tbWl0MjMyNTI5ODozM2U0ZjgwZWU2OWI1MTY4YmFkZjM3ZWRiZmVkNzk2ZWI0ODQzNGI5,Rafael J. Wysocki,Rafael J. Wysocki,"ACPI / PM: Ignore spurious SCI wakeups from suspend-to-idle

The ACPI SCI (System Control Interrupt) is set up as a wakeup IRQ
during suspend-to-idle transitions and, consequently, any events
signaled through it wake up the system from that state.  However,
on some systems some of the events signaled via the ACPI SCI while
suspended to idle should not cause the system to wake up.  In fact,
quite often they should just be discarded.

Arguably, systems should not resume entirely on such events, but in
order to decide which events really should cause the system to resume
and which are spurious, it is necessary to resume up to the point
when ACPI SCIs are actually handled and processed, which is after
executing dpm_resume_noirq() in the system resume path.

For this reasons, add a loop around freeze_enter() in which the
platforms can process events signaled via multiplexed IRQ lines
like the ACPI SCI and add suspend-to-idle hooks that can be
used for this purpose to struct platform_freeze_ops.

In the ACPI case, the ->wake hook is used for checking if the SCI
has triggered while suspended and deferring the interrupt-induced
system wakeup until the events signaled through it are actually
processed sufficiently to decide whether or not the system should
resume.  In turn, the ->sync hook allows all of the relevant event
queues to be flushed so as to prevent events from being missed due
to race conditions.

In addition to that, some ACPI code processing wakeup events needs
to be modified to use the ""hard"" version of wakeup triggers, so that
it will cause a system resume to happen on device-induced wakeup
events even if the ""soft"" mechanism to prevent the system from
suspending is not enabled.  However, to preserve the existing
behavior with respect to suspend-to-RAM, this only is done in
the suspend-to-idle case and only if an SCI has occurred while
suspended.

Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/33e4f80ee69b5168badf37edbfed796eb48434b9,2017-06-12
MDY6Q29tbWl0MjMyNTI5ODpmM2I3ZWFhZTFiMzVlYjgwNzc2MTBlYjdjN2RiMDQyYzliMDY0NWUx,Rafael J. Wysocki,Rafael J. Wysocki,"Revert ""ACPI / sleep: Ignore spurious SCI wakeups from suspend-to-idle""

Revert commit eed4d47efe95 (ACPI / sleep: Ignore spurious SCI wakeups
from suspend-to-idle) as it turned out to be premature and triggered
a number of different issues on various systems.

That includes, but is not limited to, premature suspend-to-RAM aborts
on Dell XPS 13 (9343) reported by Dominik.

The issue the commit in question attempted to address is real and
will need to be taken care of going forward, but evidently more work
is needed for this purpose.

Reported-by: Dominik Brodowski <linux@dominikbrodowski.net>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/f3b7eaae1b35eb8077610eb7c7db042c9b0645e1,2017-06-06
MDY6Q29tbWl0MjMyNTI5ODo4NzhkOGRiMDM5ZGFhYzA5MzgyMzhlOWE0MGE1YmQ2ZTUwZWUzYzli,Benjamin Tissoires,Rafael J. Wysocki,"Revert ""ACPI / button: Change default behavior to lid_init_state=open""

Revert commit 77e9a4aa9de1 (ACPI / button: Change default behavior to
lid_init_state=open) which changed the kernel's behavior on laptops
that boot with closed lids and expect the lid switch state to be
reported accurately by the kernel.

If you boot or resume your laptop with the lid closed on a docking
station while using an external monitor connected to it, both internal
and external displays will light on, while only the external should.

There is a design choice in gdm to only provide the greeter on the
internal display when lit on, so users only see a gray area on the
external monitor. Also, the cursor will not show up as it's by
default on the internal display too.

To ""fix"" that, users have to open the laptop once and close it once
again to sync the state of the switch with the hardware state.

Even if the ""method"" operation mode implementation can be buggy on
some platforms, the ""open"" choice is worse.  It breaks docking
stations basically and there is no way to have a user-space hwdb to
fix that.

On the contrary, it's rather easy in user-space to have a hwdb
with the problematic platforms. Then,  libinput (1.7.0+) can fix
the state of the lid switch for us: you need to set the udev
property LIBINPUT_ATTR_LID_SWITCH_RELIABILITY to 'write_open'.

When libinput detects internal keyboard events, it will overwrite the
state of the switch to open, making it reliable again.  Given that
logind only checks the lid switch value after a timeout, we can
assume the user will use the internal keyboard before this timeout
expires.

For example, such a hwdb entry is:

libinput:name:*Lid Switch*:dmi:*svnMicrosoftCorporation:pnSurface3:*
 LIBINPUT_ATTR_LID_SWITCH_RELIABILITY=write_open

Link: https://bugzilla.gnome.org/show_bug.cgi?id=782380
Cc: 4.11+ <stable@vger.kernel.org> # 4.11+
Signed-off-by: Benjamin Tissoires <benjamin.tissoires@redhat.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/878d8db039daac0938238e9a40a5bd6e50ee3c9b,2017-05-10
MDY6Q29tbWl0MjMyNTI5ODpmMzY5ZmRmNGY2NjEzMjJiNzNmMzMwN2U5ZjNjZDU1ZmIzYTIwMTIz,Lv Zheng,Rafael J. Wysocki,"Revert ""ACPI / button: Remove lid_init_state=method mode""

This reverts commit ecb10b694b72ca5ea51b3c90a71ff2a11963425a.

The only expected ACPI control method lid device's usage model is

 1. Listen to the lid notification,
 2. Evaluate _LID after being notified by BIOS,
 3. Suspend the system (if users configure to do so) after seeing ""close"".

It's not ensured that BIOS will notify OS after boot/resume, and
it's not ensured that BIOS will always generate ""open"" event upon
opening the lid.

But there are 2 wrong usage models:

 1. When the lid device is responsible for suspend/resume the system,
    userspace requires to see ""open"" event to be paired with ""close"" after
    the system is resumed, or it will suspend the system again.

 2. When an external monitor connects to the laptop attached docks,
    userspace requires to see ""close"" event after the system is resumed so
    that it can determine whether the internal display should remain dark
    and the external display should be lit on.

After we made default kernel behavior to be suitable for usage model 1,
users of usage model 2 start to report regressions for such behavior
change.

Reversion of button.lid_init_state=method doesn't actually reverts to old
default behavior as doing so can enter a regression loop, but facilitates
users to work the reported regressions around with
button.lid_init_state=method.

Fixes: ecb10b694b72 (ACPI / button: Remove lid_init_state=method mode)
Cc: 4.11+ <stable@vger.kernel.org> # 4.11+
Link: https://bugzilla.kernel.org/show_bug.cgi?id=195455
Link: https://bugzilla.redhat.com/show_bug.cgi?id=1430259
Tested-by: Steffen Weber <steffen.weber@gmail.com>
Tested-by: Julian Wiedmann <julian.wiedmann@jwi.name>
Reported-by: Joachim Frieben <jfrieben@hotmail.com>
Signed-off-by: Lv Zheng <lv.zheng@intel.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/f369fdf4f661322b73f3307e9f3cd55fb3a20123,2017-05-09
MDY6Q29tbWl0MjMyNTI5ODplZWQ0ZDQ3ZWZlOTUwOGI4NTViMDk3NTRjZjZkZTQzMjVkOGEyZjBk,Rafael J. Wysocki,Rafael J. Wysocki,"ACPI / sleep: Ignore spurious SCI wakeups from suspend-to-idle

The ACPI SCI (System Control Interrupt) is set up as a wakeup IRQ
during suspend-to-idle transitions and, consequently, any events
signaled through it wake up the system from that state.  However,
on some systems some of the events signaled via the ACPI SCI while
suspended to idle should not cause the system to wake up.  In fact,
quite often they should just be discarded.

Arguably, systems should not resume entirely on such events, but in
order to decide which events really should cause the system to resume
and which are spurious, it is necessary to resume up to the point
when ACPI SCIs are actually handled and processed, which is after
executing dpm_resume_noirq() in the system resume path.

For this reasons, add a loop around freeze_enter() in which the
platforms can process events signaled via multiplexed IRQ lines
like the ACPI SCI and add suspend-to-idle hooks that can be
used for this purpose to struct platform_freeze_ops.

In the ACPI case, the ->wake hook is used for checking if the SCI
has triggered while suspended and deferring the interrupt-induced
system wakeup until the events signaled through it are actually
processed sufficiently to decide whether or not the system should
resume.  In turn, the ->sync hook allows all of the relevant event
queues to be flushed so as to prevent events from being missed due
to race conditions.

In addition to that, some ACPI code processing wakeup events needs
to be modified to use the ""hard"" version of wakeup triggers, so that
it will cause a system resume to happen on device-induced wakeup
events even if the ""soft"" mechanism to prevent the system from
suspending is not enabled (that also helps to catch device-induced
wakeup events occurring during suspend transitions in progress).

Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/eed4d47efe9508b855b09754cf6de4325d8a2f0d,2017-04-26
MDY6Q29tbWl0MjMyNTI5ODplY2IxMGI2OTRiNzJjYTVlYTUxYjNjOTBhNzFmZjJhMTE5NjM0MjVh,Lv Zheng,Rafael J. Wysocki,"ACPI / button: Remove lid_init_state=method mode

The mode is buggy, and lid_init__state=open is more useful than this
mode, so this patch makes it deprecated.

Signed-off-by: Lv Zheng <lv.zheng@intel.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/ecb10b694b72ca5ea51b3c90a71ff2a11963425a,2017-01-12
MDY6Q29tbWl0MjMyNTI5ODo3N2U5YTRhYTlkZTEwY2MxNDE4YmY5YTg5MjM2Njk4ODgwMmE4MDI1,Lv Zheng,Rafael J. Wysocki,"ACPI / button: Change default behavior to lid_init_state=open

More and more platforms need the button.lid_init_state=open quirk. This
patch sets it the default behavior.

If a platform doesn't send lid open event or lid open event is lost due to
the underlying system problems, then we can compare various combinations:
1. systemd/acpid is used to suspend system or not, systemd has a special
   logic forcing open event after resuming;
2. _LID returns a cached value or not.

The result is as follows:

 1. lid_init_state=method
   1. cached
      1. resumed by lid:
         (x) event=close
         (x) systemd=suspends again
         (x) acpid=suspends again
         (x) state=close
      2. resumed by other:
         (o) event=close
         (x) systemd=suspends again
         (x) acpid=suspends again
         (o) state=close
   2. non-cached
      1. resumed by lid:
         (o) event=open
         (o) systemd=resumes
         (o) acpid=resumes
         (o) state=open
      2. resumed by other:
         (o) event=close
         (x) systemd=suspends again
         (x) acpid=suspends again
         (o) state=close
 2. lid_init_state=open
   1. cached
      1. resumed by lid:
         (o) event=open
         (o) systemd=resumes
         (o) acpid=resumes
         (x) state=close
      2. resumed by other:
         (x) event=open
         (o) systemd=resumes
         (o) acpid=resumes
         (o) state=close
   2. non-cached
      1. resumed by lid:
         (o) event=open
         (o) systemd=resumes
         (o) acpid=resumes
         (o) state=open
      2. resumed by other:
         (x) event=open
         (o) systemd=resumes
         (o) acpid=resumes
         (o) state=close
 3. lid_init_state=ignore
   1. cached
      1. resumed by lid:
         (o) event=none
         (x) systemd=suspends again
         (o) acpid=resumes
         (x) state=close
      2. resumed by other:
         (o) event=none
         (x) systemd=suspends again
         (o) acpid=resumes
         (o) state=close
   2. non-cached
      1. resumed by lid:
         (o) event=none
         (x) systemd=suspends again
         (o) acpid=resumes
         (o) state=open
      2. resumed by other:
         (o) event=none
         (x) systemd=suspends again
         (o) acpid=resumes
         (o) state=close

As a conclusion:
 1. With systemd changed, lid_init_state=ignore has only one problem and the
    problem comes from an underlying issue, not userspace and kernel lid
    handling.
 2. Without systemd changed, lid_init_state=open can be the default
    behavior as the pass ratio is not much worse than lid_init_state=ignore.
 3. lid_init_state=method is buggy, we can have a separate patch to make it
    deprectated.

Link: https://bugzilla.kernel.org/show_bug.cgi?id=187271
Signed-off-by: Lv Zheng <lv.zheng@intel.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/77e9a4aa9de10cc1418bf9a892366988802a8025,2017-01-12
MDY6Q29tbWl0MjMyNTI5ODpkZmE0NmM1MGY2NWI2Y2ExMGNlYTM4OTMyN2E2ZjFmMTc0OWJjNjMz,Lv Zheng,Rafael J. Wysocki,"ACPI / button: Fix an issue in button.lid_init_state=ignore mode

On most platforms, _LID returning value, lid open/close events are all
reliable, but there are exceptions. Some AML tables report wrong initial
lid state [1], and some of them never report lid open state [2].
The usage model on such buggy platforms is:
1. The initial lid state returned from _LID is not reliable;
2. The lid open event is not reliable;
3. The lid close event is always reliable, used by the platform firmware to
   trigger OSPM power saving operations.
This usage model is not compliant to the Linux SW_LID model as the Linux
userspace is very strict to the reliability of the open events.

In order not to trigger issues on such buggy platforms, the ACPI button
driver currently implements a lid_init_state=open quirk to send additional
""open"" event after resuming. However, this is still not sufficient because:
1. Some special usage models (e.x., the dark resume scenario) cannot be
   supported by this mode.
2. If a ""close"" event is not used to trigger ""suspend"", then the subsequent
   ""close"" events cannot be seen by the userspace.
So we need to stop sending the additional ""open"" event and switch the
driver to lid_init_state=ignore mode and make sure the platform triggered
events can be reliably delivered to the userspace. The userspace programs
then can be changed to not to be strict to the ""open"" events on such buggy
platforms.

Why will the subsequent ""close"" events be lost? This is because the input
layer automatically filters redundant events for switch events. Thus given
that the buggy AML tables do not guarantee paired ""open""/""close"" events,
the ACPI button driver currently is not able to guarantee that the platform
triggered reliable events can be always be seen by the userspace via
SW_LID.

This patch adds a mechanism to insert lid events as a compensation for the
platform triggered ones to form a complete event switches in order to make
sure that the platform triggered events can always be reliably delivered
to the userspace. This essentially guarantees that the platform triggered
reliable ""close"" events will always be relibly delivered to the userspace.

However this mechanism is not suitable for lid_init_state=open/method as
it should not send the complement switch event for the unreliable initial
lid state notification. 2 unreliable events can trigger unexpected
behavior. Thus this patch only implements this mechanism for
lid_init_state=ignore.

Known issues:
1. Possible alternative approach
   This approach is based on the fact that Linux requires a switch event
   type for LID events. Another approach is to use key event type to
   implement ACPI lid events.
   With SW event type, since ACPI button driver inserts wrong lid events,
   there could be a potential issue that an ""open"" event issued from some
   AML update methods could result in a wrong ""close"" event to be delivered
   to the userspace. While using KEY event type, there is no such problem.
   However there may not be such a kind of real case, and if there is such
   a case, it is worked around in this patch as the complement switch event
   is only generated for ""close"" event in order to deliver the reliable
   ""close"" event to the userspace.

Link: https://bugzilla.kernel.org/show_bug.cgi?id=89211 # [1]
Link: https://bugzilla.kernel.org/show_bug.cgi?id=106151 # [1]
Link: https://bugzilla.kernel.org/show_bug.cgi?id=106941 # [2]
Signed-off-by: Lv Zheng <lv.zheng@intel.com>
Suggested-by: Dmitry Torokhov <dmitry.torokhov@gmail.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/dfa46c50f65b6ca10cea389327a6f1f1749bc633,2016-08-17
MDY6Q29tbWl0MjMyNTI5ODplMzcwY2M4NjQwMzA1YWEyZmE0MmI4NTJjY2NkODllODBjMjhkOWEw,Benjamin Tissoires,Rafael J. Wysocki,"ACPI / button: remove pointer to old lid_sysfs on unbind

When we removed the procfs dir on error or if the driver is
unbound, the two variables acpi_lid_dir and acpi_button_dir
were not reset. On the next rebind, those static variables
were not null and we couldn't re-register the device again.

Signed-off-by: Benjamin Tissoires <benjamin.tissoires@redhat.com>
Acked-by: Lv Zheng <lv.zheng@intel.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/e370cc8640305aa2fa42b852cccd89e80c28d9a0,2016-07-29
MDY6Q29tbWl0MjMyNTI5ODozNTQwYzMyYTlhZTRjYjIzYWI3MGY3Nzk4ZjQ1YWZmYzAyNzYyZmE3,Lv Zheng,Rafael J. Wysocki,"ACPI / button: Add quirks for initial lid state notification

Linux userspace (systemd-logind) keeps on rechecking lid state when the
lid state is closed. If it failed to update the lid state to open after
boot/resume, the system suspending right after the boot/resume could be
resulted.

Graphics drivers also use the lid notifications to implment
MODESET_ON_LID_OPEN option.

Before the situation is improved from the userspace and from the graphics
driver, users can simply configure ACPI button driver to send initial
""open"" lid state using button.lid_init_state=open to avoid such kind of
issues.

And our ultimate target should be making button.lid_init_state=ignore
the default behavior.  This patch implements the 2 options and keep the
old behavior (button.lid_init_state=method).

Link: https://lkml.org/2016/3/7/460
Link: https://github.com/systemd/systemd/issues/2087
Signed-off-by: Lv Zheng <lv.zheng@intel.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/3540c32a9ae4cb23ab70f7798f45affc02762fa7,2016-06-01
MDY6Q29tbWl0MjMyNTI5ODplZTdlMjI2NTNmNTA3NzE2OWVjNzA2YjVhMTQwYTNiZTlkYjM4MWU3,Lv Zheng,Rafael J. Wysocki,"ACPI / button: Refactor functions to eliminate redundant code

(Correct a wrong macro usage.)

This patch simplies the code by merging some redundant code.

No functional changes.

Signed-off-by: Lv Zheng <lv.zheng@intel.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/ee7e22653f5077169ec706b5a140a3be9db381e7,2016-06-01
MDY6Q29tbWl0MjMyNTI5ODpjMmRkNDIwMDM0ZjI0ZjM1NmI4NmY5MDIyMmVmMTkxNDhiODJhNWMx,Lv Zheng,Rafael J. Wysocki,"ACPI / button: Remove initial lid state notification

The _LID control method's initial returning value is not reliable.

The _LID control method is described to return the ""current"" lid state.
However the word of ""current"" has ambiguity, many BIOSen return the lid
state upon the last lid notification instead of returning the lid state
upon the last _LID evaluation. There won't be difference when the _LID
control method is evaluated during the runtime, the problem is its initial
returning value. When the BIOSen implement this control method with cached
value, the initial returning value is likely not reliable. There are simply
so many examples retuning ""close"" as initial lid state (Link 1), sending
this state to the userspace causes suspending right after booting/resuming.

Since the lid state is implemented by the BIOSen, the kernel lid driver has
no idea how it can be correct, this patch stops sending the initial lid
state to the userspace to try to avoid sending the wrong lid state to the
userspace to trigger such kind of wrong suspending. This actually reverts
the following commit introduced for fixing a Novell bug:

  Commit: 23de5d9ef2a4bbc4f733f58311bcb7cf6239c813
  Subject: ACPI: button: send initial lid state after add and resume

Link: https://bugzilla.kernel.org/show_bug.cgi?id=89211
Link: https://bugzilla.kernel.org/show_bug.cgi?id=106151
Link: https://bugzilla.kernel.org/show_bug.cgi?id=106941
Link: https://bugzilla.novell.com/show_bug.cgi?id=326814
Signed-off-by: Lv Zheng <lv.zheng@intel.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/c2dd420034f24f356b86f90222ef19148b82a5c1,2016-06-01
MDY6Q29tbWl0MjMyNTI5ODo0YzYyZGJiY2U5MDJjZjJhZmE4OGNhYzg5ZWM2N2M4MjgxNjBmNDMx,Jarkko Nikula,Rafael J. Wysocki,"ACPI: Remove FSF mailing addresses

There is no need to carry potentially outdated Free Software Foundation
mailing address in file headers since the COPYING file includes it.

Signed-off-by: Jarkko Nikula <jarkko.nikula@linux.intel.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/4c62dbbce902cf2afa88cac89ec67c828160f431,2015-06-26
MDY6Q29tbWl0MjMyNTI5ODplNzFlZWIyYTZiY2M2MjgyYjk1MjE1ZWIzNTNhM2FjOWNlM2UwZGUz,Rafael J. Wysocki,Rafael J. Wysocki,"ACPI / button: Do not propagate wakeup-from-suspend events

During system suspend mark ACPI buttons (other than the lid) as
""suspended"" and if in that state, report wakeup events on button
events, but do not propagate those events up the stack.

This prevents systems from being turned off after a button-triggered
wakeup from the ""freeze"" sleep state.

Link: https://bugzilla.kernel.org/show_bug.cgi?id=77611
Tested-on: Acer Aspire S5, Toshiba Portege R500
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/e71eeb2a6bcc6282b95215eb353a3ac9ce3e0de3,2014-07-22
MDY6Q29tbWl0MjMyNTI5ODowYmY2MzY4ZWU4ZjI1ODI2ZDA2NDVjMGY3YTRmMTdjODg0NTM1NmE0,Lan Tianyu,Rafael J. Wysocki,"ACPI / button: Add ACPI Button event via netlink routine

Commit 1696d9d (ACPI: Remove the old /proc/acpi/event interface)
removed ACPI Button event which originally was sent to userspace via
/proc/acpi/event. This caused ACPI shutdown regression on gentoo
in VirtualBox. Now ACPI events are sent to userspace via netlink,
so add ACPI Button event back via netlink routine.

References: https://bugzilla.kernel.org/show_bug.cgi?id=71721
Reported-and-tested-by: Richard Musil <richard.musil@gmail.com>
Signed-off-by: Lan Tianyu <tianyu.lan@intel.com>
Cc: 3.11+ <stable@vger.kernel.org> # 3.11+
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/0bf6368ee8f25826d0645c0f7a4f17c8845356a4,2014-03-15
MDY6Q29tbWl0MjMyNTI5ODoyZGU5ZmQxN2MwMzU5ZmVhMGMyYWI1YWUzOTNjNDBkNmQyOTliY2Fm,Shuah Khan,Rafael J. Wysocki,"ACPI / button: fix button driver compile error when CONFIG_PM_SLEEP is undefined

The ACPI button driver defines acpi_button_resume() when
CONFIG_PM_SLEEP is defined. This results in the following
compile error when CONFIG_PM_SLEEP is undefined:

drivers/acpi/button.c:85:8: error: âacpi_button_resumeâ undeclared here (not in a function)

Signed-off-by: Shuah Khan <shuah.kh@samsung.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/2de9fd17c0359fea0c2ab5ae393c40d6d299bcaf,2014-02-13
MDY6Q29tbWl0MjMyNTI5ODo4ZWFhMjlmOTJhNjZjOTJhZGUxYWQ2NjNkMTRkOTc1ZDc3NmVmNDky,Lan Tianyu,Rafael J. Wysocki,"ACPI / Button: Fix enabling button GPEs twice

Button GPEs have been enabled in the acpi_wake_device_init() during
boot and the button driver enables them for the second time.
Consequently, it is necessary to do

# echo disable > /sys/firmware/acpi/interrupts/gpeXXX

twice in a row to disable those GPEs via sysfs. This patch is to
remove the GPE enabling code from the button driver to avoid the
problem.

Signed-off-by: Lan Tianyu <tianyu.lan@intel.com>
[rjw: Changelog]
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/8eaa29f92a66c92ade1ad663d14d975d776ef492,2013-12-12
MDY6Q29tbWl0MjMyNTI5ODo4YjQ4NDYzZjg5NDI5YWY0MDhmZjY5NTI0NGRjNjI3ZTFhY2ZmNGY3,Lv Zheng,Rafael J. Wysocki,"ACPI: Clean up inclusions of ACPI header files

Replace direct inclusions of <acpi/acpi.h>, <acpi/acpi_bus.h> and
<acpi/acpi_drivers.h>, which are incorrect, with <linux/acpi.h>
inclusions and remove some inclusions of those files that aren't
necessary.

First of all, <acpi/acpi.h>, <acpi/acpi_bus.h> and <acpi/acpi_drivers.h>
should not be included directly from any files that are built for
CONFIG_ACPI unset, because that generally leads to build warnings about
undefined symbols in !CONFIG_ACPI builds.  For CONFIG_ACPI set,
<linux/acpi.h> includes those files and for CONFIG_ACPI unset it
provides stub ACPI symbols to be used in that case.

Second, there are ordering dependencies between those files that always
have to be met.  Namely, it is required that <acpi/acpi_bus.h> be included
prior to <acpi/acpi_drivers.h> so that the acpi_pci_root declarations the
latter depends on are always there.  And <acpi/acpi.h> which provides
basic ACPICA type declarations should always be included prior to any other
ACPI headers in CONFIG_ACPI builds.  That also is taken care of including
<linux/acpi.h> as appropriate.

Signed-off-by: Lv Zheng <lv.zheng@intel.com>
Cc: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Cc: Matthew Garrett <mjg59@srcf.ucam.org>
Cc: Tony Luck <tony.luck@intel.com>
Cc: ""H. Peter Anvin"" <hpa@zytor.com>
Acked-by: Bjorn Helgaas <bhelgaas@google.com> (drivers/pci stuff)
Acked-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com> (Xen stuff)
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/8b48463f89429af408ff695244dc627e1acff4f7,2013-12-03
MDY6Q29tbWl0MjMyNTI5ODo3NjNmNTI3YjY4YzZiMDI2NDM5ZjBiMTJlYmUyMzJkOTZiNTU2M2Rm,Lan Tianyu,Rafael J. Wysocki,"ACPI / button: Using input_set_capability() to mark device's event capability

Input layer provides input_set_capability() to set input device's event
related bits. This patch is to use it to replace origin code.

Signed-off-by: Lan Tianyu <tianyu.lan@intel.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/763f527b68c6b026439f0b12ebe232d96b5563df,2013-09-12
MDY6Q29tbWl0MjMyNTI5ODoxNjk2ZDlkYzU3ZTA2MmNlNTIwMGY2YTQyYTZhYWFkYTE1YjQzNGJi,Thomas Renninger,Rafael J. Wysocki,"ACPI: Remove the old /proc/acpi/event interface

It is quite some time that this one has been deprecated.
Get rid of it.

Should some really important user be overseen, it may be reverted and
the userspace program worked on first, but it is time to do something
to get rid of this old stuff...

Signed-off-by: Thomas Renninger <trenn@suse.de>
Acked-by: Matthew Garrett <matthew.garrett@nebula.com>
Acked-by: Henrique de Moraes Holschuh <hmh@hmh.eng.br>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/1696d9dc57e062ce5200f6a42a6aaada15b434bb,2013-07-15
MDY6Q29tbWl0MjMyNTI5ODpkOWRkYTc4YmFkODc5NTk1ZDhjNDIyMGEwNjdmYzAyOWQ2NDg0YTE2,Al Viro,Al Viro,"procfs: new helper - PDE_DATA(inode)

The only part of proc_dir_entry the code outside of fs/proc
really cares about is PDE(inode)->data.  Provide a helper
for that; static inline for now, eventually will be moved
to fs/proc, along with the knowledge of struct proc_dir_entry
layout.

Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>",https://api.github.com/repos/torvalds/linux/git/commits/d9dda78bad879595d8c4220a067fc029d6484a16,2013-03-31
MDY6Q29tbWl0MjMyNTI5ODo2MjcwZGE2ZjRkNWE3ZTEzY2ZmOTg1ODVkMjVjNjc0MmFlYzVhMzNj,Andy Shevchenko,Rafael J. Wysocki,"ACPI: suppress compiler warnings in button.c

This patch fixes following compiler warnings when build via make W=1:

drivers/acpi/button.c:220:5: warning: no previous prototype for âacpi_lid_notifier_registerâ [-Wmissing-prototypes]
drivers/acpi/button.c:226:5: warning: no previous prototype for âacpi_lid_notifier_unregisterâ [-Wmissing-prototypes]
drivers/acpi/button.c:232:5: warning: no previous prototype for âacpi_lid_openâ [-Wmissing-prototypes]

Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/6270da6f4d5a7e13cff98585d25c6742aec5a33c,2013-03-11
MDY6Q29tbWl0MjMyNTI5ODo1MWZhYzgzODhhMDMyNWE0M2YwYWU2NzQ1M2VjZTJjMzczZTJlYzI4,Rafael J. Wysocki,Rafael J. Wysocki,"ACPI: Remove useless type argument of driver .remove() operation

The second argument of ACPI driver .remove() operation is only used
by the ACPI processor driver and the value passed to that driver
through it is always available from the given struct acpi_device
object's removal_type field.  For this reason, the second ACPI driver
.remove() argument is in fact useless, so drop it.

Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
Reviewed-by: Jiang Liu <jiang.liu@huawei.com>
Acked-by: Toshi Kani <toshi.kani@hp.com>
Acked-by: Yinghai Lu <yinghai@kernel.org>",https://api.github.com/repos/torvalds/linux/git/commits/51fac8388a0325a43f0ae67453ece2c373e2ec28,2013-01-23
MDY6Q29tbWl0MjMyNTI5ODo0NjZlNzhmNzc5YjJiODExZjc3ZGJkMmViZjYxOGRkZDQyZTNlZDUw,Mika Westerberg,Len Brown,"ACPI/button: convert to module_acpi_driver()

Signed-off-by: Mika Westerberg <mika.westerberg@linux.intel.com>
Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/466e78f779b2b811f77dbd2ebf618ddd42e3ed50,2012-09-07
MDY6Q29tbWl0MjMyNTI5ODo5MDY5MjQwNDgwZTI0YTJkNmNlMjM0MDRjOWFkNmNhYmY1OWI3MjU4,Rafael J. Wysocki,Rafael J. Wysocki,"ACPI / PM: Fix unused function warnings for CONFIG_PM_SLEEP

According to compiler warnings, several suspend/resume functions
in ACPI drivers are not used for CONFIG_PM_SLEEP unset, so add
#ifdefs to prevent them from being built in that case.

Signed-off-by: Rafael J. Wysocki <rjw@sisk.pl>",https://api.github.com/repos/torvalds/linux/git/commits/9069240480e24a2d6ce23404c9ad6cabf59b7258,2012-08-09
MDY6Q29tbWl0MjMyNTI5ODoxYmU1MzJkZTgzNGFiN2IxOGNlMjBkYzJlNTZlNzI0NzcwYmViNzlk,Rafael J. Wysocki,Rafael J. Wysocki,"ACPI: Use struct dev_pm_ops for power management in the button driver

Make the ACPI button driver define its PM callbacks through
a struct dev_pm_ops object rather than by using legacy PM hooks
in struct acpi_device_ops.

Signed-off-by: Rafael J. Wysocki <rjw@sisk.pl>",https://api.github.com/repos/torvalds/linux/git/commits/1be532de834ab7b18ce20dc2e56e724770beb79d,2012-06-27
MDY6Q29tbWl0MjMyNTI5ODo5MTJiNzQyN2ZjMTM0NjdiYWMwNDJjYzcyZjJlY2NiZGJjMzlkNzcz,Zhang Rui,Len Brown,"ACPI button: remove unused procfs I/F

Remove unused ACPI button procfs interface.
Only /proc/acpi/button/lid/LID/state remains.

Signed-off-by: Zhang Rui <rui.zhang@intel.com>
Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/912b7427fc13467bac042cc72f2eccbdbc39d773,2011-03-23
MDY6Q29tbWl0MjMyNTI5ODpjMTlmOWE4NGVjODA3ZGE1N2ZkNzViYmQ5YTNmMmI4MjY5NjExZjc5,Rafael J. Wysocki,Rafael J. Wysocki,"ACPI / Button: Avoid disabling wakeup unnecessarily on remove

If a button device had already been enabled to wake up the system
from sleep states before the button driver saw it, the driver
shouldn't disable the device's wakeup capability when being detached
from the device.

Signed-off-by: Rafael J. Wysocki <rjw@sisk.pl>",https://api.github.com/repos/torvalds/linux/git/commits/c19f9a84ec807da57fd75bbd9a3f2b8269611f79,2011-02-08
MDY6Q29tbWl0MjMyNTI5ODo1MTkwNzI2NzY1YjQwNzc0YzA2OWUxODdhOTU4ZTEwY2NkOTcwZTY1,Rafael J. Wysocki,Rafael J. Wysocki,"ACPI: Remove the wakeup.run_wake_count device field

The wakeup.run_wake_count ACPI device field is only used by the PCI
runtime PM code to ""protect"" devices from being prepared for
generating wakeup signals more than once in a row.  However, it
really doesn't provide any protection, because (1) all of the
functions it is supposed to protect use their own reference counters
effectively ensuring that the device will be set up for generating
wakeup signals just once and (2) the PCI runtime PM code uses
wakeup.run_wake_count in a racy way, since nothing prevents
acpi_dev_run_wake() from being called concurrently from two different
threads for the same device.

Remove the wakeup.run_wake_count ACPI device field which is
unnecessary, confusing and used in a wrong way.

Signed-off-by: Rafael J. Wysocki <rjw@sisk.pl>",https://api.github.com/repos/torvalds/linux/git/commits/5190726765b40774c069e187a958e10ccd970e65,2011-02-08
MDY6Q29tbWl0MjMyNTI5ODoxZjgzNTExYmQ4ZjQ0YjhhOWUyZDgyMjYzYjJjOTVmMjZhNjI1ZmNj,Rafael J. Wysocki,Len Brown,"ACPI / PM: Report wakeup events from buttons

Since ACPI buttons and lids can be configured to wake up the system
from sleep states, report wakeup events from these devices.

Signed-off-by: Rafael J. Wysocki <rjw@sisk.pl>
Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/1f83511bd8f44b8a9e2d82263b2c95f26a625fcc,2011-01-06
MDY6Q29tbWl0MjMyNTI5ODpmMmI1NmJjODA4YWRkYjkwOGE1YmY0MzVkOWI5NDJjMDJhZjlhN2M0,Rafael J. Wysocki,Len Brown,"ACPI / PM: Use device wakeup flags for handling ACPI wakeup devices

There are ACPI devices (buttons and the laptop lid) that can wake up
the system from sleep states and have no ""physical"" companion
devices.  The ACPI subsystem uses two flags, wakeup.state.enabled and
wakeup.flags.always_enabled, for handling those devices, but they
are not accessible through the standard device wakeup infrastructure.
User space can only control them via the /proc/acpi/wakeup interface
that is not really convenient (e.g. the way in which devices are
enabled to wake up the system is not portable between different
systems, because it requires one to know the devices' ""names"" used in
the system's ACPI tables).

To address this problem, use standard device wakeup flags instead of
the special ACPI flags for handling those devices.  In particular,
use device_set_wakeup_capable() to mark the ACPI wakeup devices
during initialization and use device_set_wakeup_enable() to allow
or disallow them to wake up the system from sleep states.  Rework
the /proc/acpi/wakeup interface to take these changes into account.

Signed-off-by: Rafael J. Wysocki <rjw@sisk.pl>
Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/f2b56bc808addb908a5bf435d9b942c02af9a7c4,2011-01-06
MDY6Q29tbWl0MjMyNTI5ODo2MjBlMTEyY2ZlMWM5MjgxYzE3NmRlOGFkMWE3NjkxYzRlYjQ5NTBk,Thomas Renninger,Len Brown,"ACPI/PNP: A HID value of an object never changes -> make it const

Signed-off-by: Thomas Renninger <trenn@suse.de>
Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/620e112cfe1c9281c176de8ad1a7691c4eb4950d,2010-10-01
MDY6Q29tbWl0MjMyNTI5ODphNDQwNjFhYThiNWQ1OGIyNzI5ZmFjYTRjMTU1YTk0YTViZWEyYTA5,Rafael J. Wysocki,Len Brown,"ACPICA: Remove wakeup GPE reference counting which is not used

After the previous patch that introduced acpi_gpe_wakeup() and
modified the ACPI suspend and wakeup code to use it, the third
argument of acpi_{enable|disable}_gpe() and the GPE wakeup
reference counter are not necessary any more.  Remove them and
modify all of the users of acpi_{enable|disable}_gpe()
accordingly.  Also drop GPE type constants that aren't used
any more.

Signed-off-by: Rafael J. Wysocki <rjw@sisk.pl>
Signed-off-by: Len Brown <len.brown@intel.com>
Signed-off-by: Bob Moore <robert.moore@intel.com>
Signed-off-by: Lin Ming <ming.m.lin@intel.com>
Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/a44061aa8b5d58b2729faca4c155a94a5bea2a09,2010-07-01
MDY6Q29tbWl0MjMyNTI5ODpjYjFjYjE3ODBmMjAyNWE3ZDYxMmRlMDkxMzFiZjY1MzBmODBmYjFh,Rafael J. Wysocki,Len Brown,"ACPI / PM: Do not enable GPEs for system wakeup in advance

After commit 9630bdd9b15d2f489c646d8bc04b60e53eb5ec78
(ACPI: Use GPE reference counting to support shared GPEs) the wakeup
enable mask bits of GPEs are set as soon as the GPEs are enabled to
wake up the system.  Unfortunately, this leads to a regression
reported by Michal Hocko, where a system is woken up from ACPI S5 by
a device that is not supposed to do that, because the wakeup enable
mask bit of this device's GPE is always set when
acpi_enter_sleep_state() calls acpi_hw_enable_all_wakeup_gpes(),
although it should only be set if the device is supposed to wake up
the system from the target state.

To work around this issue, rework the ACPI power management code so
that GPEs are not enabled to wake up the system upfront, but only
during a system state transition when the target state of the system
is known.  [Of course, this means that the reference counting of
""wakeup"" GPEs doesn't really make sense and it is sufficient to
set/unset the wakeup mask bits for them during system sleep
transitions.  This will allow us to simplify the GPE handling code
quite a bit, but that change is too intrusive for 2.6.35.]

Fixes https://bugzilla.kernel.org/show_bug.cgi?id=15951

Signed-off-by: Rafael J. Wysocki <rjw@sisk.pl>
Reported-and-tested-by: Michal Hocko <mhocko@suse.cz>
Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/cb1cb1780f2025a7d612de09131bf6530f80fb1a,2010-06-17
MDY6Q29tbWl0MjMyNTI5ODo1YTBlM2FkNmFmODY2MGJlMjFjYTk4YTk3MWNkMDBmMzMxMzE4YzA1,Tejun Heo,Tejun Heo,"include cleanup: Update gfp.h and slab.h includes to prepare for breaking implicit slab.h inclusion from percpu.h

percpu.h is included by sched.h and module.h and thus ends up being
included when building most .c files.  percpu.h includes slab.h which
in turn includes gfp.h making everything defined by the two files
universally available and complicating inclusion dependencies.

percpu.h -> slab.h dependency is about to be removed.  Prepare for
this change by updating users of gfp and slab facilities include those
headers directly instead of assuming availability.  As this conversion
needs to touch large number of source files, the following script is
used as the basis of conversion.

  http://userweb.kernel.org/~tj/misc/slabh-sweep.py

The script does the followings.

* Scan files for gfp and slab usages and update includes such that
  only the necessary includes are there.  ie. if only gfp is used,
  gfp.h, if slab is used, slab.h.

* When the script inserts a new include, it looks at the include
  blocks and try to put the new include such that its order conforms
  to its surrounding.  It's put in the include block which contains
  core kernel includes, in the same order that the rest are ordered -
  alphabetical, Christmas tree, rev-Xmas-tree or at the end if there
  doesn't seem to be any matching order.

* If the script can't find a place to put a new include (mostly
  because the file doesn't have fitting include block), it prints out
  an error message indicating which .h file needs to be added to the
  file.

The conversion was done in the following steps.

1. The initial automatic conversion of all .c files updated slightly
   over 4000 files, deleting around 700 includes and adding ~480 gfp.h
   and ~3000 slab.h inclusions.  The script emitted errors for ~400
   files.

2. Each error was manually checked.  Some didn't need the inclusion,
   some needed manual addition while adding it to implementation .h or
   embedding .c file was more appropriate for others.  This step added
   inclusions to around 150 files.

3. The script was run again and the output was compared to the edits
   from #2 to make sure no file was left behind.

4. Several build tests were done and a couple of problems were fixed.
   e.g. lib/decompress_*.c used malloc/free() wrappers around slab
   APIs requiring slab.h to be added manually.

5. The script was run on all .h files but without automatically
   editing them as sprinkling gfp.h and slab.h inclusions around .h
   files could easily lead to inclusion dependency hell.  Most gfp.h
   inclusion directives were ignored as stuff from gfp.h was usually
   wildly available and often used in preprocessor macros.  Each
   slab.h inclusion directive was examined and added manually as
   necessary.

6. percpu.h was updated not to include slab.h.

7. Build test were done on the following configurations and failures
   were fixed.  CONFIG_GCOV_KERNEL was turned off for all tests (as my
   distributed build env didn't work with gcov compiles) and a few
   more options had to be turned off depending on archs to make things
   build (like ipr on powerpc/64 which failed due to missing writeq).

   * x86 and x86_64 UP and SMP allmodconfig and a custom test config.
   * powerpc and powerpc64 SMP allmodconfig
   * sparc and sparc64 SMP allmodconfig
   * ia64 SMP allmodconfig
   * s390 SMP allmodconfig
   * alpha SMP allmodconfig
   * um on x86_64 SMP allmodconfig

8. percpu.h modifications were reverted so that it could be applied as
   a separate patch and serve as bisection point.

Given the fact that I had only a couple of failures from tests on step
6, I'm fairly confident about the coverage of this conversion patch.
If there is a breakage, it's likely to be something in one of the arch
headers which should be easily discoverable easily on most builds of
the specific arch.

Signed-off-by: Tejun Heo <tj@kernel.org>
Guess-its-ok-by: Christoph Lameter <cl@linux-foundation.org>
Cc: Ingo Molnar <mingo@redhat.com>
Cc: Lee Schermerhorn <Lee.Schermerhorn@hp.com>",https://api.github.com/repos/torvalds/linux/git/commits/5a0e3ad6af8660be21ca98a971cd00f331318c05,2010-03-24
MDY6Q29tbWl0MjMyNTI5ODpmNTE3NzA5ZDY1YmVlZDk1ZjUyZjAyMWI0M2UzMDM1YjUyZWY3OTFh,Rafael J. Wysocki,Jesse Barnes,"ACPI / PM: Add more run-time wake-up fields

Use the run_wake flag to mark all devices for which run-time wake-up
events may be generated by the platform.  Introduce a new wake-up
flag, always_enabled, for marking devices that should be permanently
enabled to generate run-time events.  Also, introduce a reference
counter for run-wake devices and a function that will initialize all
of the run-time wake-up fields for given device.

Signed-off-by: Rafael J. Wysocki <rjw@sisk.pl>
Acked-by: Len Brown <len.brown@intel.com>
Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>",https://api.github.com/repos/torvalds/linux/git/commits/f517709d65beed95f52f021b43e3035b52ef791a,2010-02-17
MDY6Q29tbWl0MjMyNTI5ODo5NjMwYmRkOWIxNWQyZjQ4OWM2NDZkOGJjMDRiNjBlNTNlYjVlYzc4,Rafael J. Wysocki,Jesse Barnes,"ACPI: Use GPE reference counting to support shared GPEs

ACPI GPEs may map to multiple devices.  The current GPE interface
only provides a mechanism for enabling and disabling GPEs, making
it difficult to change the state of GPEs at runtime without extensive
cooperation between devices.

Add an API to allow devices to indicate whether or not they want
their device's GPE to be enabled for both runtime and wakeup events.

Remove the old GPE type handling entirely, which gets rid of various
quirks, like the implicit disabling with GPE type setting. This
requires a small amount of rework in order to ensure that non-wake
GPEs are enabled by default to preserve existing behaviour.

Based on patches from Matthew Garrett <mjg@redhat.com>.

Signed-off-by: Matthew Garrett <mjg@redhat.com>
Signed-off-by: Rafael J. Wysocki <rjw@sisk.pl>
Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>",https://api.github.com/repos/torvalds/linux/git/commits/9630bdd9b15d2f489c646d8bc04b60e53eb5ec78,2010-02-17
MDY6Q29tbWl0MjMyNTI5ODoxM2MxOTljMGQwY2Y3OGIyNzU5Mjk5MTEyOWZiOGNiY2ZjNTE2NGRl,Zhao Yakui,Len Brown,"ACPI: Use the return result of ACPI lid notifier chain correctly

On some laptops it will return NOTIFY_OK(non-zero) when calling the ACPI LID
notifier. Then it is used as the result of ACPI LID resume function, which
will complain the following warning message in course of suspend/resume:

     >PM: Device PNP0C0D:00 failed to resume: error 1

This patch is to eliminate the above warning message.

http://bugzilla.kernel.org/show_bug.cgi?id=14782

Signed-off-by: Zhao Yakui <yakui.zhao@intel.com>
Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/13c199c0d0cf78b27592991129fb8cbcfc5164de,2009-12-15
MDY6Q29tbWl0MjMyNTI5ODoyYzkwN2I3MmRiNGRkNGU4YWY2ZGNjYjZlMGFjMTIyZDc4NjI3Yjhk,Jesse Barnes,Len Brown,"ACPI button: don't try to use a non-existent lid device

If a call comes in to check the lid state but there's no lid device
present, we should return -ENODEV.

Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>
Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/2c907b72db4dd4e8af6dccb6e0ac122d78627b8d,2009-10-07
MDY6Q29tbWl0MjMyNTI5ODo3ZTEyNzE1ZWNjNDdhOGE1OTE1NGFmZTI3NDZlNDg5OTgyMjViYjY5,Jesse Barnes,Eric Anholt,"ACPI button: provide lid status functions

Some drivers need to know when a lid event occurs and get the current
status.  This can be useful for when a platform firmware clobbers some
hardware state at lid time, and a driver needs to restore things when
the lid is opened again.

Acked-by: Matthew Garrett <mjg59@srcf.ucam.org>
Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>
Signed-off-by: Eric Anholt <eric@anholt.net>",https://api.github.com/repos/torvalds/linux/git/commits/7e12715ecc47a8a59154afe2746e48998225bb69,2009-09-10
MDY6Q29tbWl0MjMyNTI5ODphMTkyYTk1ODBiY2M0MTY5MmJlMWYzNmI3N2MzYjY4MTgyN2Y1NjZh,Len Brown,Len Brown,"ACPI: Move definition of PREFIX from acpi_bus.h to internal..h

Linux/ACPI core files using internal.h all PREFIX ""ACPI: "",
however, not all ACPI drivers use/want it -- and they
should not have to #undef PREFIX to define their own.

Add GPL commment to internal.h while we are there.

This does not change any actual console output,
asside from a whitespace fix.

Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/a192a9580bcc41692be1f36b77c3b681827f566a,2009-07-28
MDY6Q29tbWl0MjMyNTI5ODpkNjhiNTk3Yzg4M2NmODYzYzcyMTY1NjRjYWUwOGE0NzMwZDU2Y2Mx,Bjorn Helgaas,Len Brown,"ACPI: button: remove control method/fixed hardware distinctions

This patch removes the driver distinction between control method (CM)
and fixed hardware (FF) buttons.  We previously needed that so we
could install either a fixed event handler or a notify handler, but
the Linux/ACPI code now handles that for us, so we don't need to
worry about it.

Note that this removes the FF/CM annotation from the ""info"" files
in /proc.  For example,

    /proc/acpi/button/PWRF/info:
    -type:		Power Button (FF)
    +type:		Power Button

I don't think there's anything meaningful user-space can do by
knowing whether a button is a control method or a fixed hardware
button, so nobody should be looking at the FF/CM.

Signed-off-by: Bjorn Helgaas <bjorn.helgaas@hp.com>
Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/d68b597c883cf863c7216564cae08a4730d56cc1,2009-04-08
MDY6Q29tbWl0MjMyNTI5ODoxMDZjMTllN2I5NzhlMWI4NGVhNWNhYmJkNDcwYTBkZGNlZDU3N2M4,Bjorn Helgaas,Len Brown,"ACPI: button: remove button->device pointer

We no longer need a pointer from struct acpi_button back to the
struct acpi_device.  Everywhere we used that pointer, we either
already have, or can easily get, the acpi_device pointer without
using the copy from acpi_button.  So this patch removes the
structure element.

Signed-off-by: Bjorn Helgaas <bjorn.helgaas@hp.com>
Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/106c19e7b978e1b84ea5cabbd470a0ddced577c8,2009-04-08
MDY6Q29tbWl0MjMyNTI5ODpiZjA0YTc3MjI3ZGI3NmYxNjNiYzIzNTVlZjRlMTc2Nzk0OTg3YmUy,Bjorn Helgaas,Len Brown,"ACPI: button: cache hid/name/class pointers

This patch adds temporaries to cache the acpi_device_hid(),
acpi_device_name(), and acpi_device_class() pointers so we
don't have to clutter the code with so many uses of those
interfaces.

Signed-off-by: Bjorn Helgaas <bjorn.helgaas@hp.com>
Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/bf04a77227db76f163bc2355ef4e176794987be2,2009-04-08
MDY6Q29tbWl0MjMyNTI5ODoxYmNlODExMzFjNzEwNjRiYzMxNjMwNzhmMjQ1NDViODM5YTMxOTY3,Bjorn Helgaas,Len Brown,"ACPI: button: use Linux style for getting driver_data

It's typical and slightly more compact to look up the driver_data
structure by initializing the automatic variable at its definition.

Signed-off-by: Bjorn Helgaas <bjorn.helgaas@hp.com>
Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/1bce81131c71064bc3163078f24545b839a31967,2009-04-08
MDY6Q29tbWl0MjMyNTI5ODplMmZiOTc1NGQyNzUxMzkxOGE0OTM2ZThjYmFhZDUwZmY1NmNmZDNk,Bjorn Helgaas,Len Brown,"ACPI: button: remove unnecessary null pointer checks

Better to oops and learn about a bug than to silently cover it up.

Signed-off-by: Bjorn Helgaas <bjorn.helgaas@hp.com>
Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/e2fb9754d27513918a4936e8cbaad50ff56cfd3d,2009-04-08
MDY6Q29tbWl0MjMyNTI5ODo1MGE0ZGE4OTAxMDJhNDU1ZTVjZDNkZDM1OGMzODY1MGQwNzE3OGQz,Bjorn Helgaas,Len Brown,"ACPI: button: whitespace changes

This patch changes a bit of whitespace to follow Linux conventions.

Signed-off-by: Bjorn Helgaas <bjorn.helgaas@hp.com>
Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/50a4da890102a455e5cd3dd358c38650d07178d3,2009-04-08
MDY6Q29tbWl0MjMyNTI5ODozNzNjZmMzNjBlYzc3M2JlMmY3NjE1ZTU5YTE5ZjMzMTMyNTVkYjdj,Bjorn Helgaas,Len Brown,"ACPI: button: use .notify method instead of installing handler directly

This patch adds a .notify() method.  The presence of .notify() causes
Linux/ACPI to manage event handlers and notify handlers on our behalf,
so we don't have to install and remove them ourselves.

Note that events from fixed hardware buttons now show up as a special
notify event, so to preserve user-space backward compatibility, we
convert that back to ACPI_BUTTON_NOTIFY_STATUS.

Signed-off-by: Bjorn Helgaas <bjorn.helgaas@hp.com>
Reviewed-by: Alex Chiang <achiang@hp.com>
CC: Alexey Starikovskiy <alexey.y.starikovskiy@linux.intel.com>
Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/373cfc360ec773be2f7615e59a19f3313255db7c,2009-03-30
MDY6Q29tbWl0MjMyNTI5ODo5OWI3NjIzMzgwM2JlYWIzMDIxMjNkMjQzZWVhOWU0MTE0OTgwNGYz,Alexey Dobriyan,Alexey Dobriyan,"proc 2/2: remove struct proc_dir_entry::owner

Setting ->owner as done currently (pde->owner = THIS_MODULE) is racy
as correctly noted at bug #12454. Someone can lookup entry with NULL
->owner, thus not pinning enything, and release it later resulting
in module refcount underflow.

We can keep ->owner and supply it at registration time like ->proc_fops
and ->data.

But this leaves ->owner as easy-manipulative field (just one C assignment)
and somebody will forget to unpin previous/pin current module when
switching ->owner. ->proc_fops is declared as ""const"" which should give
some thoughts.

->read_proc/->write_proc were just fixed to not require ->owner for
protection.

rmmod'ed directories will be empty and return ""."" and "".."" -- no harm.
And directories with tricky enough readdir and lookup shouldn't be modular.
We definitely don't want such modular code.

Removing ->owner will also make PDE smaller.

So, let's nuke it.

Kudos to Jeff Layton for reminding about this, let's say, oversight.

http://bugzilla.kernel.org/show_bug.cgi?id=12454

Signed-off-by: Alexey Dobriyan <adobriyan@gmail.com>",https://api.github.com/repos/torvalds/linux/git/commits/99b76233803beab302123d243eea9e41149804f3,2009-03-25
MDY6Q29tbWl0MjMyNTI5ODowYjcwODRhYzY3ZmI4NGYwY2YyZjhiYzAyZDdlMGRlYTg1MjFkZDJk,Alexey Starikovskiy,Len Brown,"ACPICA: Use spinlock for acpi_{en|dis}able_gpe

Disabling gpe might interfere with gpe detection/handling,
thus producing ""interrupt not handled"" errors.
Ironically, disabling of GPE from interrupt context is already
under spinlock, so only userspace needs to start using it.

Signed-off-by: Alexey Starikovskiy <astarikovskiy@suse.de>
Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/0b7084ac67fb84f0cf2f8bc02d7e0dea8521dd2d,2008-10-25
MDY6Q29tbWl0MjMyNTI5ODo4OTU5NWI4ZjI4NTBhMDgwZDI5MGJmNzc4ZWM5MzNlYTFkOTlmNzhl,Bjorn Helgaas,Len Brown,"ACPI: consolidate ACPI_*_COMPONENT definitions in acpi_drivers.h

Move all the component definitions for drivers to a single shared place,
include/acpi/acpi_drivers.h.

Signed-off-by: Bjorn Helgaas <bjorn.helgaas@hp.com>
Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/89595b8f2850a080d290bf778ec933ea1d99f78e,2008-11-07
MDY6Q29tbWl0MjMyNTI5ODpkZjMxNmU5MzkxMDBlNzg5YjNjNWQ0ZDEwMjYxOWNjZjU4MzRiZDAw,Guillem Jover,Len Brown,"ACPI: Always report a sync event after a lid state change

Currently not always an EV_SYN event is reported to userland
after the EV_SW SW_LID event has been sent. This is easy to verify
by using âinput-eventsâ from input-utils and just closing and opening
the lid.

Signed-off-by: Guillem Jover <guillem.jover@nokia.com>
Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/df316e939100e789b3c5d4d102619ccf5834bd00,2008-10-23
MDY6Q29tbWl0MjMyNTI5ODoyNzY2M2M1ODU1YjEwYWY5ZWM2N2JjN2RmYmEwMDE0MjZiYTIxMjIy,Matthew Wilcox,Len Brown,"ACPI: Change acpi_evaluate_integer to support 64-bit on 32-bit kernels

As of version 2.0, ACPI can return 64-bit integers.  The current
acpi_evaluate_integer only supports 64-bit integers on 64-bit platforms.
Change the argument to take a pointer to an acpi_integer so we support
64-bit integers on all platforms.

lenb: replaced use of ""acpi_integer"" with ""unsigned long long""
lenb: fixed bug in acpi_thermal_trips_update()

Signed-off-by: Matthew Wilcox <willy@linux.intel.com>
Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/27663c5855b10af9ec67bc7dfba001426ba21222,2008-10-10
MDY6Q29tbWl0MjMyNTI5ODpkYjg5YjRmMGRiYWI4MzdkMGYzZGUyYzNlOTQyN2E4ZDUzOTNhZmEz,Pavel Machek,Len Brown,"ACPI: catch calls of acpi_driver_data on pointer of wrong type

Catch attempts to use of acpi_driver_data on pointers of wrong type.

akpm: rewritten to use proper C typechecking and remove the
""function""-used-as-lvalue thing.

Signed-off-by: Pavel Machek <pavel@suse.cz>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/db89b4f0dbab837d0f3de2c3e9427a8d5393afa3,2008-09-22
MDY6Q29tbWl0MjMyNTI5ODpjZjdhY2ZhYjAzMmZmMjYyZjQyOTU0MzI4Y2RmZDIwYTVkOWFhYWFj,Denis V. Lunev,Linus Torvalds,"acpi: use non-racy method for proc entries creation

Use proc_create()/proc_create_data() to make sure that ->proc_fops and ->data
be setup before gluing PDE to main tree.

Add correct ->owner to proc_fops to fix reading/module unloading race.

Signed-off-by: Denis V. Lunev <den@openvz.org>
Cc: Len Brown <lenb@kernel.org>
Cc: Alexey Dobriyan <adobriyan@gmail.com>
Cc: ""Eric W. Biederman"" <ebiederm@xmission.com>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>",https://api.github.com/repos/torvalds/linux/git/commits/cf7acfab032ff262f42954328cdfd20a5d9aaaac,2008-04-29
MDY6Q29tbWl0MjMyNTI5ODozYjM0ZTUyMzJmYTk3NzZlOWE0YjNmNTM5Y2Q5ZmVlNzYwOWM5MDBl,Andrey Borzenkov,Len Brown,"ACPI: button: make real parent for input devices in device tree

Signed-off-by: Andrey Borzenkov <arvidjaar@mail.ru>
Cc: Dmitry Torokhov <dtor@mail.ru>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/3b34e5232fa9776e9a4b3f539cd9fee7609c900e,2008-03-04
MDY6Q29tbWl0MjMyNTI5ODoyM2RlNWQ5ZWYyYTRiYmM0ZjczM2Y1ODMxMWJjYjdjZjYyMzljODEz,Alexey Starikovskiy,Len Brown,"ACPI: button: send initial lid state after add and resume

Input layer should know about initial state of lid switch,
even before first notify.

Reference: https://bugzilla.novell.com/show_bug.cgi?id=326814

Signed-off-by: Alexey Starikovskiy <astarikovskiy@suse.de>
Acked-by: Rafael J. Wysocki <rjw@sisk.pl>
Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/23de5d9ef2a4bbc4f733f58311bcb7cf6239c813,2007-10-22
MDY6Q29tbWl0MjMyNTI5ODo3YjE5YWRhMmVkM2MxZWNjYjlmZTk0ZDc0YjA1ZTE0MjgyMjQ2NjNk,Jiri Slaby,Linus Torvalds,"get rid of input BIT* duplicate defines

get rid of input BIT* duplicate defines

use newly global defined macros for input layer. Also remove includes of
input.h from non-input sources only for BIT macro definiton. Define the
macro temporarily in local manner, all those local definitons will be
removed further in this patchset (to not break bisecting).
BIT macro will be globally defined (1<<x)

Signed-off-by: Jiri Slaby <jirislaby@gmail.com>
Cc: <dtor@mail.ru>
Acked-by: Jiri Kosina <jkosina@suse.cz>
Cc: <lenb@kernel.org>
Acked-by: Marcel Holtmann <marcel@holtmann.org>
Cc: <perex@suse.cz>
Acked-by: Mauro Carvalho Chehab <mchehab@infradead.org>
Cc: <vernux@us.ibm.com>
Cc: <malattia@linux.it>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>",https://api.github.com/repos/torvalds/linux/git/commits/7b19ada2ed3c1eccb9fe94d74b05e1428224663d,2007-10-19
MDY6Q29tbWl0MjMyNTI5ODoxNGUwNGZiMzRmZmE4MmVlNjFhZTY5Zjk4ZDhmY2ExMmQyZThlMzFj,Len Brown,Len Brown,"ACPI: Schedule /proc/acpi/event for removal

Schedule /proc/acpi/event for removal in 6 months.

Re-name acpi_bus_generate_event() to acpi_bus_generate_proc_event()
to make sure there is no confusion that it is for /proc/acpi/event only.

Add CONFIG_ACPI_PROC_EVENT to allow removal of /proc/acpi/event.
There is no functional change if CONFIG_ACPI_PROC_EVENT=y

Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/14e04fb34ffa82ee61ae69f98d8fca12d2e8e31c,2007-08-23
MDY6Q29tbWl0MjMyNTI5ODoxYmE5MGUzYTg3YzQ2NTAwNjIzYWZkYzM4OTg1NzNlNGE1ZWJiMjFi,Thomas Renninger,Len Brown,"ACPI: autoload modules - Create __mod_acpi_device_table symbol for all ACPI drivers

modpost is going to use these to create e.g. acpi:ACPI0001
in modules.alias.

Signed-off-by: Thomas Renninger <trenn@suse.de>
Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/1ba90e3a87c46500623afdc3898573e4a5ebb21b,2007-07-23
MDY6Q29tbWl0MjMyNTI5ODo3Y2RhOTNlMDA4ZTFhNDc3OTcwYWRiZjgyZGJhODFhNWQ0ZjBhZTQw,Len Brown,Len Brown,"ACPI: delete extra #defines in /drivers/acpi/ drivers

Cosmetic only.

Except in a single case, #define ACPI_*_DRIVER_NAME
were invoked 0 or 1 times.

Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/7cda93e008e1a477970adbf82dba81a5d4f0ae40,2007-02-13
MDY6Q29tbWl0MjMyNTI5ODpjMmI2NzA1Yjc1ZDljN2FmZjk4YTQ2MDJhMzIyMzA2MzllMTA4OTFj,Len Brown,Len Brown,"ACPI: fix acpi_driver.name usage

It was erroneously used as a description rather than a name.

ie. turn this:

lenb@se7525gp2:/sys> ls bus/acpi/drivers
ACPI AC Adapter Driver  ACPI Embedded Controller Driver  ACPI Power Resource Driver
ACPI Battery Driver     ACPI Fan Driver                  ACPI Processor Driver
ACPI Button Driver      ACPI PCI Interrupt Link Driver   ACPI Thermal Zone Driver
ACPI container driver   ACPI PCI Root Bridge Driver      hpet

into this:

lenb@se7525gp2:~> ls /sys/bus/acpi/drivers
ac  battery  button  container  ec  fan  hpet  pci_link  pci_root  power  processor  thermal

Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/c2b6705b75d9c7aff98a4602a32230639e10891c,2007-02-13
MDY6Q29tbWl0MjMyNTI5ODpmNTJmZDY2ZDJlYTc5NDAxMGMyZDc1MzZjZjhlNmFiZWQwYWM0OTQ3,Len Brown,Len Brown,"ACPI: clean up ACPI_MODULE_NAME() use

cosmetic only

Make ""module name"" actually match the file name.
Invoke with ';' as leaving it off confuses Lindent and gcc doesn't care.
Fix indentation where Lindent did get confused.

Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/f52fd66d2ea794010c2d7536cf8e6abed0ac4947,2007-02-13
MDY6Q29tbWl0MjMyNTI5ODo5NzVhOGUzZWQyYjllYWI5ZjA2MmExZTBiYTdmZTE4MGUxNTIwNGUx,Len Brown,Len Brown,"Pull sysfs into test branch

Conflicts:

	Documentation/feature-removal-schedule.txt
	include/acpi/acpi_drivers.h

Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/975a8e3ed2b9eab9f062a1e0ba7fe180e15204e1,2007-02-03
MDY6Q29tbWl0MjMyNTI5ODpiZmQ4MDIyM2Q3M2Y4MGUxZDFjNjlkYWNlOTE1MTc1NmIzZWYzYjQ5,Alexey Starikovskiy,Len Brown,"ACPI: correct id for fixed buttons

ACPI_BUTTON_HID_POWERF was changed, but this change was not propogated to
button.c, thus breaking detection of fixed power and sleep buttons.

Signed-off-by: Alexey Starikovskiy <alexey.y.starikovskiy@linux.intel.com>
Signed-off-by: Andrew Morton <akpm@osdl.org>
Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/bfd80223d73f80e1d1c69dace9151756b3ef3b49,2007-02-01
MDY6Q29tbWl0MjMyNTI5ODpjMDk2OGYwZWEyMWQxMGI2NzIwMjQ2ZTFlOTZiZDZhN2ExNjE5NjRk,Dmitry Torokhov,Len Brown,"ACPI: button: register with input layer

In addition to signalling button/lid events through /proc/acpi/event,
create separate input devices and report KEY_POWER, KEY_SLEEP and
SW_LID through input layer.  Also remove unnecessary casts and variable
initializations, clean up formatting.

Sleep button may autorepeat but userspace will have to filter duplicate
sleep requests anyway (and discard unprocessed events right after
wakeup).

Unlike /proc/acpi/event interface input device corresponding to LID
switch reports true lid state instead of just a counter. SW_LID is
active when lid is closed.

The driver now depends on CONFIG_INPUT.

Signed-off-by: Dmitry Torokhov <dtor@mail.ru>
Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/c0968f0ea21d10b6720246e1e96bd6a7a161964d,2006-11-09
MDY6Q29tbWl0MjMyNTI5ODpkNzUwODAzMjhhZmZiNGIyNjhkYTQzMGI3MDc0Y2M4MTM5Y2M2NjJh,Arjan van de Ven,Len Brown,"ACPI: add 'const' to several ACPI file_operations

Signed-off-by: Arjan van de Ven <arjan@linux.intel.com>
Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/d75080328affb4b268da430b7074cc8139cc662a,2006-07-04
MDY6Q29tbWl0MjMyNTI5ODo2YzY4OTUzNzcyNmVjNjY1MjQ2ZDJmNjBjNDg0NzViZTJlZmFjMmQw,Patrick Mochel,Len Brown,"ACPI: button: Remove unneeded acpi_handle from driver.

Signed-off-by: Patrick Mochel <mochel@linux.intel.com>
Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/6c689537726ec665246d2f60c48475be2efac2d0,2006-05-19
MDY6Q29tbWl0MjMyNTI5ODoyN2IxZDNlODViMWRmZDkwMzdkM2ZiYjk4YjJlMmFhY2NhMDFkYTM5,Patrick Mochel,Len Brown,"ACPI: button: Use acpi_device's handle instead of driver's

Signed-off-by: Patrick Mochel <mochel@linux.intel.com>
Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/27b1d3e85b1dfd9037d3fbb98b2e2aacca01da39,2006-05-19
MDY6Q29tbWl0MjMyNTI5ODpkNTUwZDk4ZDMzMTczNzhkOTNhNDg2OWRiMjA0NzI1ZDI3MGVjODEy,Patrick Mochel,Len Brown,"ACPI: delete tracing macros from drivers/acpi/*.c

Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/d550d98d3317378d93a4869db204725d270ec812,2006-06-27
MDY6Q29tbWl0MjMyNTI5ODo2NDY4NDYzYWJkNzA1MWZjYzI5ZjNlZTdjOTMxZjliYmJiMjZmNWE0,Len Brown,Len Brown,"ACPI: un-export ACPI_ERROR() -- use printk(KERN_ERR...)

Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/6468463abd7051fcc29f3ee7c931f9bbbb26f5a4,2006-06-27
MDY6Q29tbWl0MjMyNTI5ODphNmZjNjcyMDJlMDIyNGU2YzlkMWQyODVjYzBiNDQ0YmNlODg3ZWQ1,Thomas Renninger,Len Brown,"ACPI: Enable ACPI error messages w/o CONFIG_ACPI_DEBUG

Signed-off-by: Thomas Renninger <trenn@suse.de>
Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/a6fc67202e0224e6c9d1d285cc0b444bce887ed5,2006-06-27
MDY6Q29tbWl0MjMyNTI5ODo0YmU0NGZjZDNiZjY0OGI3ODJmNDQ2MGZkMDZkZmFlNmM0MmRlZDRi,Len Brown,Len Brown,"[ACPI] Lindent all ACPI files

Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/4be44fcd3bf648b782f4460fd06dfae6c42ded4b,2005-08-05
MDY6Q29tbWl0MjMyNTI5ODpiMzRhODAzMGVlYWI0ZDU5ZGNkZDg2ZGUzOGY2OTI3YjllZGQ0NDFm,Alexey Starikovskiy,Len Brown,"[ACPI] restore /proc/acpi/button/ (ala 2.6.12)

Signed-off-by Alexey Starikovskiy <alexey.y.starikovskiy@intel.com>
Signed-off-by Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/b34a8030eeab4d59dcdd86de38f6927b9edd441f,2005-08-03
MDY6Q29tbWl0MjMyNTI5ODpiZDQ2OThkYWQzMDIzYWUxMzdiMzY2YzczNmUyOWNhNmVhZjNiOWY3,Alexey Starikovskiy,Len Brown,"[ACPI] Allow simultaneous Fixed Feature and Control Method buttons
delete /proc/acpi/button

http://bugzilla.kernel.org/show_bug.cgi?id=1920

Signed-off-by: Alexey Starikovskiy <alexey.y.starikovskiy@intel.com>
Signed-off-by: Len Brown <len.brown@intel.com>",https://api.github.com/repos/torvalds/linux/git/commits/bd4698dad3023ae137b366c736e29ca6eaf3b9f7,2005-03-18
MDY6Q29tbWl0MjMyNTI5ODoxZGExNzdlNGMzZjQxNTI0ZTg4NmI3ZjFiOGEwYzFmYzczMjFjYWMy,Linus Torvalds,Linus Torvalds,"Linux-2.6.12-rc2

Initial git repository build. I'm not bothering with the full history,
even though we have it. We can create a separate ""historical"" git
archive of that later if we want to, and in the meantime it's about
3.2GB when imported into git - space that would just make the early
git days unnecessarily complicated, when we don't have a lot of good
infrastructure for it.

Let it rip!",https://api.github.com/repos/torvalds/linux/git/commits/1da177e4c3f41524e886b7f1b8a0c1fc7321cac2,2005-04-16
